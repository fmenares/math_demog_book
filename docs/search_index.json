[
["index.html", "Mathematical Demography Chapter 1 Introduction", " Mathematical Demography Josh R. Goldstein 2020-06-29 Chapter 1 Introduction Mathematical demography book ``` "],
["intro.html", "Chapter 2 Introduction to Demographic Heterogeneity 2.1 Outline 2.2 Part I. Conceptual Introduction 2.3 Part II. Formal Analysis 2.4 Conclusions", " Chapter 2 Introduction to Demographic Heterogeneity 2.1 Outline What demographic heterogeneity is (and isn’t) Dynamics of population growth with two sub-groups Keyfitz’s result \\(\\bar{r}&#39;(t) = \\sigma^2_r(t)\\). Ken’s model of Poisson heterogeneity 2.2 Part I. Conceptual Introduction 2.2.1 What is Demographic Heterogeneity? If we see different outcomes (e.g., people dying at different ages), is this Demographic Heterogeneity? NO. Demographic heterogeneity \\(=\\) different rates for different folks. In a demographically heterogeneous population, people are of different types, with different type-specific rates. (These types can be discrete, with individuals being homogeneous within their type, or they can be continuous with possibly no individual having exactly the same risk as another.) 2.2.2 An example Let’s draw 10 individuals from a homogeneous population and heterogeneous population. ## Homogeneous hazard of 1/10 set.seed(13) x.homo &lt;- rexp(10, rate = 1/10) ## Heterogeneous hazard (half 1/6 and half 1/13) ## Note: I didn&#39;t pick these particular numbers for any specific reason x.hetero &lt;- c(rexp(5, rate = 1/6), rexp(5, rate = 1/13)) par(mfrow = c(1,2)) dotchart(x.homo, main = &quot;homogenous variation&quot;) dotchart(x.hetero, main = &quot;heterogeneous variation&quot;) Figure 2.1: Homogeneity and Heterogeneity Can you tell which is which? Homogeneous: Chance only Heterogeneous: Chance + group variation in risk Would we expect to see a difference if we increased sample? ANSWER THIS Analogies ? [Social inequality:] equal opportunity vs. equal outcomes [Analysis of variance] \\(\\mbox{total variance} = \\mbox{within group} + \\mbox{between group}\\) [Statistical models] \\(y = a + b x + \\epsilon\\) What’s new? Dynamics. Heterogeneous populations evolve differently. Aggregates \\(\\neq\\) Individuals Rates of growth (or decline) Changes over time or age or duration The trajectory of even the individual differs from population average Relative positions, change of groups, may be misleading. Terminology Heterogeneity Unobserved heterogeneity Selection Selective survival Other terms? Big Caveat: Fundamental Unidentifiability Same data of \\(N\\) observations \\(N\\) draws from 1 distribution \\(1\\) draw from \\(N\\) distributions Something in-between Abel (66) and Beth (76) example. 2.2.3 A 2nd example: Exponential growth, two countries Two countries start equal size, but grow at different rates. What happens to aggregate growth rate? rA = .03 ## growth rate of A rB = .01 ## growth rate of A KA = 100 ## starting pop size KB = 100 t = 0:200 KA.t = KA*exp(rA*t) ## exp growth of A KB.t = KB*exp(rB*t) ## exp growth of B K &lt;- KA.t + KB.t ## combined pop r.bar = diff(log(K)) ## growth rate plot(t[-1], r.bar, type = &quot;l&quot;, ylim = c(0, 0.04), ylab = &quot;r.bar&quot;, xlab = &quot;time&quot;) abline(h = c(rA, rB), lty = 2) Figure 2.2: Aggregate growth rate of sub-populations A + B Questions What determines growth rate? How does it change over time? Does the process converge? 2.2.4 More examples to work Differential, constant mortality (\\(\\mu_A = .03\\); \\(\\mu_B =.01\\)) Differential, {} mortality or growth. ``Movers and Stayers’’ (Migration) ``Movers and Stayers’’ (Marriage) Fecundity: aging or heterogeneity? Divorce: duration or heterogeneity? Duration of unemployment: duration or heterogeneity? Recidivism by time out of prison 2.2.5 Application Questions Can you create a plateau? Can you create a crossover? Can you get aggregate rate to decline? Anything else? 2.3 Part II. Formal Analysis 2.3.1 Outline Keyfitz result Keyfitz USA-Mexico example Ken’s Poisson-Exponential Model 2.3.2 Keyfitz result \\[{d \\over dt}\\bar{r}(t) = \\sigma^2_r(t)\\] &gt;When group-specific growth rates are constant the rate of change of the aggregate growth rate equals the variance of the growth rates. Derivation By definition, \\[ \\bar{K}(t) = \\sum_i K_i(t) = \\sum_i K_i e^{r_i t} \\] and \\[\\bar{r}(t) = {{d \\over dt} \\bar{K}(t) \\over \\bar{K}(t)}\\] Let’s take derivatives and simplify, recalling definition of variance. SOLVE? 2.3.3 US-Mexico Example rm = 3.5/100 ru = .75/100 Km = 50 Ku = 100 t &lt;- -50:150 ## go back in time to see rise and fall of variance Kt = Km * exp(t*rm) + Ku * exp(t*ru) bar.rt &lt;- diff(log(Kt)) par(mfrow = c(2,2)) plot(t, Kt, lwd = 2, type = &#39;l&#39;) title(&#39;Total pop size (solid)\\n Group m (dashed)&#39;) lines(t, Km * exp(t*rm), lty = 2, col = &quot;red&quot;) lines(t, Ku * exp(t*ru), lty = 2, col = &quot;blue&quot;) my.v = 26 abline(v = my.v) plot(t, Kt, lwd = 2, type = &#39;l&#39;, log = &#39;y&#39;, ylim = c(.5, max(Kt))) lines(t, Km * exp(t*rm), lty = 2, col = &quot;red&quot;) lines(t, Ku * exp(t*ru), lty = 2, col = &quot;blue&quot;) abline(v = my.v) title(&quot;Total pop size (solid)\\n Group &#39;m&#39; (dashed): Log-scale&quot;) plot(t[-1], bar.rt, type = &#39;l&#39;, main = &#39;Aggregate growth rate&#39;) plot(t[-(1:2)], diff(bar.rt), type = &#39;l&#39;, main = &#39;Change in aggregate growth rate&#39;) Figure 2.3: Keyfitz result for US-Mexico 2.3.3.1 Commentary on Keyfitz result Growth rates in heterogeneous populations start at pop average and then increase. Heterogeneity pop growth We will extend to cover non-constant growth But Doesn’t tell us how much bigger \\(\\bar{K}(t)\\) is projection using constant aggregate rate \\(\\bar{r}(0)\\). Doesn’t give us a formula for time path of aggregate \\(\\bar{K}(t)\\) or \\(\\bar{r}(t)\\) Note: our homework will try to address some of this using Taylor approximation. 2.3.4 The Origin of Professor Wachter’s Poisson-Exponential Model Given a world with many sub-populations, each growing expontentially at their own rate, what can we say about the time-path of world population growth? From an email: Josh asks: Suppose we have a discrete mix of subpopulations growing at different intrinsic rates r whose maximum is r0. Is there a handy approximation for the growth path of the aggregate populations? The assumption of a discrete mix is essential here. Otherwise Tauberian theorems apply and, with a vanishingly small portion of the population close to the maximum growth rate, we do not obtain long-run exponential growth. I recommend modeling the discrete distribution of growth rates as a mixture of Poisson distributions. We are considering \\[\\begin{equation} \\label{mixture} \\bar{K}(t) = \\sum_i e^{r_i t} K_i(0). \\end{equation}\\] Ken suggests \\[\\begin{equation} \\label{ri_def} r_i = r_0 - s(\\lambda) \\cdot a, \\end{equation}\\] [\\(r_0\\)] growth rate of the fastest growing sub-population [\\(s\\)] a non-negative Poisson distributed integer [\\(\\lambda\\)] the parameter of the Poisson distribution (also it’s mean and variance) [\\(a\\)] gap between adjacent growth rates. Example: sub-populations have growth rates 3, 2, 1, 0, -1, \\(\\ldots\\) percent, then \\(r_0 = 0.03\\) and \\(a = 0.01\\). Sizes of sub-pops determined by Poisson dis’n 2.3.4.1 Closed-form result \\[ K(t) = K(0) e^{r_0 t} e^{-\\lambda (1 - e^{-at})}. \\] To derive: Write out mixture to get \\[ K(t) = K(0) e^{r_0 t} \\sum_i e^{-sat} f(s) \\] Substitute for \\(f(s)\\): \\(Pois ~ {\\lambda^s e^{-\\lambda} \\over s!}\\) Recognize that our mixture contains the series representation of \\(e^{-at}\\) Interpretation \\[ K(t) = K(0) e^{r_0 t} e^{-\\lambda (1 - e^{-at})}. \\] Dominant term contains the maximum population growth rate \\(r_0\\), Second term gives the diminishing effect of the sub-populations with smaller population growth rates over time. Some further analysis, What is the closed-form expression for \\(\\bar{r}(t)\\)? 2.3.5 Some commentary Poisson and Exponential ``fit’’ We’ll this complementarity again (e.g., with Gamma) Tractable models are super powerful for enhancing our understanding. But be careful. Avoid extremes: the model is right/wrong. A BIG caveat, are disaggregated models necessarily better? Some potential problems: Aggregate constraints? Interacting sub-populations? Illusion of precision? 2.4 Conclusions Heterogeneity as variation in risk (not just outcome) Constantly growing parts \\(\\neq\\) constantly growth whole Keyfitz result: Change in growth rate \\(=\\) variance of growth rates Poisson growth gives us a closed-form solution. "],
["frailty.html", "Chapter 3 Multiplicative Fixed Frailty 3.1 Outline 3.2 Part I. Results from Fixed Frailty 3.3 Part II. Introduction to Gamma Frailty 3.4 Conclusions", " Chapter 3 Multiplicative Fixed Frailty 3.1 Outline Review of Mortality Mathematics Multiplicative-fixed-frailty and alternatives to it. Population Survival and Hazards under fixed frailty Gamma frailty 3.1.1 Review of mortality mathematics [\\(\\ell(x)\\) or \\(S(x)\\)] probability of survival to age \\(x\\) [\\(\\mu(x)\\) or \\(h(x)\\)] hazard rate at age \\(x\\) (``minus the exponential rate of change in survival’’) Let’s treat \\(\\mu\\) as a definition. \\[ \\mu(x) \\equiv -{d \\over dx} \\log \\ell(x) \\] Can anti-differentiate (integrate) to solve for survival: \\[ \\ell(x) = s(x) = e^{-\\int_0^x \\mu(a)\\, da} \\] 3.1.2 Application: what is \\(\\ell&#39;(x)\\)? in words? taking derivative of \\(\\ell(x)\\) interpretation 3.1.2.1 Two special cases Constant hazards \\(\\mu(x) = \\mu\\). What’s \\(\\ell(x)\\)? Gompertz hazards \\(\\mu(x) = a e^{b x}\\). What’s \\(\\ell(x)\\)? 3.1.3 Extending Keyfitz to mortality \\[ {d \\over dx} \\bar{\\mu}(x) = \\mbox{average rate of change} - \\sigma_\\mu^2 \\] What is \\(\\bar{\\mu}\\)? It’s a weighted average: \\[ \\bar{\\mu}(x) = {\\int \\mu(x | z) \\ell(x | z) p(z) \\, dz \\over \\int \\ell(x | z) p(z) \\, dz} \\] To derive Keyfitz extension, differentiate with respect to age \\(x\\). (See eq (13)). A good exercise. Multiplicative Fixed frailty For individual \\(i\\), \\[ \\mu_i(x) = z_i \\mu_0(x). \\] [\\(z_i\\)] ``frailty’’ of the \\(i\\)th individual. (Usually thought of as a random variable with mean \\(1\\).) [\\(\\mu_0(x)\\)] ``Baseline hazard’’ schedule. (Also, the schedule of a person with \\(z = 1\\)). 3.1.4 fragile Which look like multiplicative fixed frailty? 3.2 Part I. Results from Fixed Frailty 3.2.1 A simulation Our questions How do we do a micro-simulation, with individuals? How does fixed frailty fit in? How do we compute pop survival, hazards, etc. How does life table of heterogeneous pop differ from baseline? 3.2.2 Let’s derive pop survival (Note: \\(\\bar{s} = \\bar{\\ell}\\)) Pop survival will be a weighted average of group survival curves \\[ \\bar{s}(x) = {p(z_1) s_1(x) + p(z_2) s_2(x) + \\ldots \\over p(z_1) + p(z_2) + \\ldots} \\] With continuous \\(z\\) (what are limits of integration?) \\[ \\bar{s}(x) = \\int s(x|z) p(z) \\, dz \\] Under Multiplicative Fixed Frailty use \\[ \\mu(x|z) = z \\mu_0(x) \\] to derive \\[\\bar{s}(x) = \\int s_0(x)^z p(z) \\,dz.\\] 3.2.3 Now population hazards (stepping stones) Definition of hazards: \\[ \\bar{\\mu}(x) = - {d \\over dx} \\log \\bar{s}(x) \\] \\[ \\bar{\\mu}(x) = \\mu_0(x) {\\int z s_0(x)^z p(z) \\, dz \\over \\int s_0(x)^z p(z) \\, dz} \\] \\[ \\bar{\\mu}(x) = \\mu_0(x) \\bar{z}(x) \\] Let’s fill in steps. 3.2.4 Rodriguez question Why isn’t population hazard a (simple) average of individual hazards? Answer: selected survival means that the distribution of frailty at age \\(x\\) differs from the starting frailty distribution at age \\(0\\). The rate of increase in hazards (AKA “LAR: Lifetable Aging Rate”) \\[ \\beta(x) = {d \\over dx} \\log \\mu(x) \\] Example: What is \\(\\beta(x)\\) for Gompertz: \\(\\mu(x) = a e^{bx}\\)? Vaupel’s result \\[ \\bar{\\beta}(x) = \\beta_0(x) - \\bar{\\mu}(x) CV_z^2(x) \\] Hazards rise less slowly in pop than in baseline If pop hazards plateau, then \\(\\bar{\\beta}(x) = 0\\) Two special cases Homogeneous pop and plateau in baseline Gompertz and constant \\(CV_z\\) (e.g., from Gamma) 3.3 Part II. Introduction to Gamma Frailty 3.3.1 The Gamma distribution What do we want in a frailty distribution? What’s the Gamma? Last math: closed form pop survival positive? a single dimension summarizing multiple factors? (Normal?) flexible? tractable? \\[ p(z | k, \\lambda) = {\\lambda^k \\over \\Gamma(k)} z^{k-1} e^{-\\lambda z} \\]. [\\(z\\)] the random variable representing frailty [\\(k, \\lambda\\)] parameters [\\(\\Gamma(k)\\)] A normalizing constant. 3.3.2 Gamma in R [Mean:] \\(k / \\lambda\\) [Variance:] $ k / ^2$ \\end{description} ## with k and lambda k = 3; lambda = 6 x &lt;- rgamma(10000, shape = k, rate= lambda) mean(x) ## [1] 0.498123 sd(x) ## [1] 0.2915809 Alternate parameterization ## with mean 1, sigma.sq sigma.sq &lt;- .25 z &lt;- rgamma(10000, shape = 1/sigma.sq, rate = 1/sigma.sq) mean(z) ## [1] 1.003287 var(z) ## [1] 0.2468513 3.3.3 Population Survival of Gamma Frailty Big picture \\[ \\bar{s}(x) = \\int s_0(x)^z p(z) \\, dz \\] Or, using our definition of survival, \\[ \\bar{s}(x) = \\int e^{-z H_0(x)} p(z) \\, dz \\] Completing the gamma \\[ \\bar{s}(x) = \\int e^{-z H_0(x)} {\\lambda^k \\over \\Gamma(k)} z^{k-1} e^{-\\lambda z} \\, dz \\] Rearranging, \\[ \\bar{s}(x) = \\lambda^k \\int { 1 \\over \\Gamma(k)} z^{k-1} e^{-z (H_0(x)+\\lambda)} \\, dz \\] Integral is like a \\(Gamma(z | k, H_0(x) + \\lambda)\\), but missing something. What? Our Result \\[ \\bar{S}(x) = {\\lambda^k \\over \\left[H_0(x) + \\lambda\\right]^k} \\] If mean = 1.0, then we can let \\(\\lambda = k = 1/\\sigma^2\\), \\[ \\bar S(x) = {1/\\sigma^2 \\over (H_0(x) + 1/\\sigma^2)^{1/ \\sigma^2}} = {1 \\over \\left(1 + \\sigma^2 H_0(x)\\right)^{1/ \\sigma^2}} \\] 3.3.4 Interpreting Gamma-frailty survival \\[ \\bar S(x) = {1 \\over \\left(1 + \\sigma^2 H_0(x)\\right)^{1/ \\sigma^2}} \\] Older ages, smaller survival. Variance not so clear, need a picture. (What if \\(\\sigma^2 = 0\\)?) x &lt;- 0:100 a = 10^-4 b = 1/10 mx.0 &lt;- a * exp(b*x) Hx.0 &lt;- cumsum(mx.0) Sx.0 &lt;- exp(-Hx.0) ## small sigma sigma.sq = .5^2 bar.S.small.sigma &lt;- 1 / (1 + sigma.sq *Hx.0)^(1/sigma.sq) ## big sigma sigma.sq = 1^2 bar.S.big.sigma &lt;- 1 / (1 + sigma.sq *Hx.0)^(1/sigma.sq) plot(x, Sx.0, lty = 2, type = &quot;l&quot;, ylim = c(0,1), ylab = &quot;Survival&quot;) lines(x, bar.S.small.sigma, col = &quot;blue&quot;) lines(x, bar.S.big.sigma, col = &quot;red&quot;) legend(&quot;bottomleft&quot;, c(&quot;Pop big.sigma&quot;, &quot;Pop small.sigma&quot;, &quot;Baseline&quot;), lty = c(1, 1, 2), bty = &quot;n&quot;, col = c(&quot;red&quot;, &quot;blue&quot;, &quot;black&quot;)) title(&quot;Gamma-frailty population survival&quot;) 3.4 Conclusions Multiplicative Fixed Frailty is one option for modeling Gave us analytical expressions for population survival and hazards including \\(\\bar{\\mu}(x) = \\mu_0(x) \\bar{z}(x)\\) Extended Keyfitz result to age-changing hazards Survival curve for Gamma "],
["gamma-frailty-with-applications.html", "Chapter 4 Gamma Frailty with Applications 4.1 From pop survival to pop hazards 4.2 Selection and observed frailty in CenSoc", " Chapter 4 Gamma Frailty with Applications 4.1 From pop survival to pop hazards We have \\[ \\bar S(x) = {1 \\over \\left(1 + \\sigma^2 H_0(x)\\right)^{1/ \\sigma^2}} \\] Let’s compute \\(\\bar\\mu(x)\\). \\[ \\bar\\mu(x) = {\\mu_0 \\over 1 + \\sigma^2 H_0(x)} \\] 4.1.1 What happens to frailty of survivors? Recall that pop hazards = baseline \\(\\times \\bar{z}(x)\\). So, \\[ \\bar\\mu(x) = \\mu_0(x) { 1 \\over 1 + \\sigma^2 H_0(x)} \\] Sketch \\(\\bar{z}(x)\\). Hint: what form does \\(H_0(x)\\) have? 4.1.1.1 Example: Gamma-Gompertz If \\(H_0(x)\\) be Gompertz, we have closed-form expression. What is it? Does \\(\\bar{z}\\) have the form \\[ {1 \\over 1 + v*e^{w x}} \\] This is a backwards S, going down. sigma.sq = .2 x = 0:100 a = 5 * 10^-4 b = 1/8 H0.x = (a/b) * (exp(b*x) - 1) bar.z = 1 / (1 + sigma.sq * H0.x) plot(x, bar.z) Look at the apparent exponential decline in tail Homework: what is proportional rate of change in \\(\\bar{z}\\) as \\(x\\) gets big? Is it close to Gompertz \\(b\\)? Average frailty in terms of survival \\[ \\bar{z}(x) = [\\bar{S}(x)]^{\\sigma^2}! \\] In real life, we observe \\(\\bar{S}(x)\\). So this allows us to say something about implied \\(\\bar{z}\\) from hazards. Reversing the logic: if we see a characteristic changing with age, then we can estimate ``\\({\\sigma^2}\\)’’ (I put in quotes because its the variance of the proportional effect of the observed characteristic.) 4.2 Selection and observed frailty in CenSoc We have a large matched sample from the 1940 census to Social Security death data observed from 1975 to 2004. This means that we can compute the survival curves of extinct cohorts and see how mortality selection changes the composition of the cohort as it ages. In this example, we use observed wage income in 1940 for the cohort born 1895 to 1900. We look at how wages of survivors increase with age as a result of selective mortality and we see if the gamma-frailty model can produce similar results. 4.2.1 Read in the data and transform the variables to what we want. We produce a variable \\(y\\) (in this case a standardized version of log wage income) to be transformed into a frailty score. ## read in dat library(data.table) dt &lt;- fread(&quot;/data/josh/CenSoc/censoc_bfdw.csv&quot;) ## Clean wage data dt[, incwage := INCWAGE] dt[incwage == 999998, incwage := NA] dt[incwage == 0, incwage := NA] hist_incwage &lt;- dt[, hist(incwage)] hist_ln_incwage &lt;- dt[, hist(log(incwage))] ## Do age at death for 1895-1900 cohorts dt[, age.at.death := dyear + dmonth/12 - (byear + bmonth/12)] my.dt &lt;- dt[byear %in% 1895:1900 &amp; dyear %in% 1975:2004] ## now limits to deaths younger than 105 my.dt[, max(age.at.death), by = byear] ## byear V1 ## 1: 1900 104.9167 ## 2: 1898 106.8333 ## 3: 1897 107.0833 ## 4: 1895 109.4167 ## 5: 1899 105.6667 ## 6: 1896 107.9167 nrow(my.dt[age.at.death &gt;= 105]) ## [1] 177 nrow(my.dt[floor(age.at.death) == 104]) ## [1] 253 ## now we have same age range for every cohort my.dt &lt;- my.dt[age.at.death &lt; 105] my.dt &lt;- my.dt[!is.na(incwage)] ## keep only non-missing Log-wages look reasonable, unimodal, kind of symmetric. We now center our variable to 0 before estimating the effect on mortality. Our model exponentiates this 0 to become 1, which is where we want our frailty measure to be centered. ## standardized log income ## log_inc_stan = log(y_orig) - mean(log(y_orig)) ## note: control for byear, since different ages in 1940 my.dt[, y_orig := incwage] my.dt[, log_inc := log(incwage)] my.dt[, log_inc_mean := mean(log_inc), by = byear] my.dt[, y := log_inc - log_inc_mean] hist_y &lt;- my.dt[, hist(y)] my.dt[, summary(y)] ## Min. 1st Qu. Median Mean 3rd Qu. Max. ## -7.0542 -0.4159 0.1661 0.0000 0.5660 4.2460 Now we’re centered at 0. 4.2.2 Show how our (life-long fixed) characteristic of interest changes by age because of mortality selection. par(mfrow = c(1,2)) my.dt[, plot(x, y_orig.bar)] ## NULL title(&quot;Wage income by surviving age&quot;, cex.main = .7) my.dt[, plot(x, y.bar)] ## NULL title(&quot;Standardized log of Wage income by surviving age&quot;, cex.main = .7) So we see annual wage income in 1940 increases by about $100 or so, or about 5% from age 75 to age 95. And more after that. Is this what we would expect from our Gamma frailty model? 4.2.3 Estimate an observed frailty for each person, call this \\(z_{obs}\\) To do this we first use Cox regression to estimate the proportional effect of \\(y\\) on hazards. The Cox model has the form \\[ \\mu_i(x) = \\mu_0(x) e^{\\beta y} \\] We can then transform \\(y\\) into a frailty score \\(z_{obs}\\), letting \\[ z_{obs} = e^{\\hat\\beta y} \\] ## now get z&#39;s library(survival) my.dt[, event := 1] m &lt;- coxph(Surv(age.at.death, event) ~ y, data = my.dt) (summary(m)) ## Call: ## coxph(formula = Surv(age.at.death, event) ~ y, data = my.dt) ## ## n= 402797, number of events= 402797 ## ## coef exp(coef) se(coef) z Pr(&gt;|z|) ## y -0.03073 0.96974 0.00177 -17.36 &lt;2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## exp(coef) exp(-coef) lower .95 upper .95 ## y 0.9697 1.031 0.9664 0.9731 ## ## Concordance= 0.512 (se = 0.001 ) ## Likelihood ratio test= 298 on 1 df, p=&lt;2e-16 ## Wald test = 301.5 on 1 df, p=&lt;2e-16 ## Score (logrank) test = 301.5 on 1 df, p=&lt;2e-16 ## coef exp(coef) se(coef) z Pr(&gt;|z|) ## y -0.03073 0.96974 0.00177 -17.36 &lt;2e-16 *** ## so a 10% increase in income reduces mortality by .3% (quite a tiny effect!) beta &lt;- coef(m) The effect is very small. Any ideas why? Now estimate our z’s. my.dt[, z := exp(beta * y)] hist_z &lt;- my.dt[, hist(z, xlim = c(0, 3))] Does this look gamma-like? 4.2.4 Calculate the variance of \\(z_{obs}\\) to be used for estimating \\(\\bar{z}_{obs}\\). (Also plot the histogram to see if it looks gamma-like) sigma.sq &lt;- var(my.dt$z) print(sigma.sq) ## [1] 0.000745355 print(sqrt(sigma.sq)) ## [1] 0.02730119 Check SD against histogram. Does it look right? 4.2.5 Use extinct cohort method to estimate survivorship \\(\\bar{S}(x)\\) Dx &lt;- my.dt[, table(floor(age.at.death))] par(mfrow = c(1,2)) plot(Dx) lx &lt;- rev(cumsum(rev(Dx))) lxpn &lt;- c(lx[-1],0) Lx &lt;- (lx + lxpn)/2 mx &lt;- Dx/Lx x &lt;- as.numeric(names(Dx)) plot(x, log(mx), type = &quot;p&quot;) ## gomp fit from ages 80 to 95 m &lt;- lm (log(mx) ~ x, subset = x %in% 80:100) lines(80:100, predict(m), lwd = 2) axis(2) ## no slowdown in mortality!! How does Dx look? Plausible? How about hazards? They are Gompertzian for a while, but how do we explain tails? plot(x, lx) 4.2.6 Estimate \\(\\hat{\\bar{z}}(x)\\) using the gamma-frailty result: \\[ \\bar{z}(x) = \\bar{S}(x)^{\\sigma^2} \\] sx.bar &lt;- lx/lx[1] z.bar.hat &lt;- sx.bar^sigma.sq Compare this to our observed \\(\\bar{z}\\) x &lt;- 74:104 z.bar &lt;- NULL for (i in 1:length(x)) { z.bar[i] &lt;- my.dt[age.at.death &gt; x[i], mean(z)] } Plot comparison plot(x, z.bar.hat, ylim = c(.995, 1.001), type = &quot;l&quot;, lty = 2) lines(x, z.bar) How did we do? I’m not quite sure why intercept of observed is not exactly 1.0. (Feel free to play around, but I don’t think this is important – I hope.) 4.2.7 Graph our results, showing plots for observed mortality selection and the gamma-frailty based estimate of mortality selection. Do this for several measures including \\(y\\), and raw (unstandardized) income. y.bar.hat &lt;- log(z.bar.hat)/beta plot(x, y.bar, ylab = &quot;log(inc) - mean(log(inc))&quot;) lines(x, y.bar.hat) title(&quot;Mean standardized log-income&quot;) legend(&quot;topleft&quot;, legend = c(&quot;observed&quot;, &quot;fitted&quot;), pch = c(1, -1), lty = c(-1, 1)) ## ( bar.log.y = mean(log(my.dt$y_orig)) ) ## [1] 7.03562 y_orig.bar.hat.wrong &lt;- exp(y.bar.hat) * exp( bar.log.y) ## this is geometric mean y_orig.bar.hat.right &lt;- exp(y.bar.hat)*y_orig.bar[1] plot(x, y_orig.bar, ylab = &quot;$ per year&quot;) title(&quot;Mean income&quot;) legend(&quot;topleft&quot;, legend = c(&quot;observed&quot;, &quot;fitted&quot;), pch = c(1, -1), lty = c(-1, 1)) lines(x, y_orig.bar.hat.wrong, lty = 2) lines(x, y_orig.bar.hat.right, lty = 1) 4.2.8 Discuss our conclusions and possible future directions to follow. How did we do? Does our gamma frailty model give basically the right prediction? How come it appears that wage income matters so little? How could we improve the measurement of wage income? What other variables could we look at? How would we expect the gamma model do with another variable, e.g. educational attainment? What is the relationship between “observed” and “unobserved” frailty? IMPORTANT: Is our work here a validation of the model’s applicability to real life? If so what are we validating? That our transformed covariate is roughly gamma distributed? Are we assuming multiplicative fixed frailty – or are we validating it’s applicability? "],
["convergence-and-cross-overs.html", "Chapter 5 Convergence and cross-overs 5.1 Outline 5.2 What happens to mortality disparities at older ages? 5.3 Student Presentation", " Chapter 5 Convergence and cross-overs 5.1 Outline Concepts Student Presentation 5.2 What happens to mortality disparities at older ages? Cumulative disadvantage Age as a leveler (Individual adaptation/plasticity, gov support, separation from unequal structures like labor market) Bad data / measurement (Unreliable ages, institutionalization changes sample, etc.) Nothing -(It’s all selection (frailty''), pop hazards but individual hazards would have remainedparallel’’.) Our goal is to examine this last ``null hypothesis.’’ What can frailty explain, and what can’t it? 5.2.1 A possible null-model 2 groups, each with internal gamma-frailty proportional baseline hazards \\[ \\mu_2(x) = R \\mu_1(x) \\] (see V&amp;M (38)) \\[ \\mu_1(x |z_1) = \\mu_1 z_1 \\\\ \\mu_2(x |z_2) = \\mu_2 z_2 \\] And, frailty terms are each gamma, with mean 1 and own variances. 5.2.2 A result: (5E) \\[ \\bar{R}(x) \\equiv {\\bar\\mu_2(x) \\over \\bar\\mu_1(x)} = {R + R\\sigma_1^2 H_1(x) \\over 1 + R \\sigma_2^2 H_1(x)} \\] Questions: If variances are equal. What happens at age 0? What happens at very old ages. If the higher mortality group has bigger frailty variance, what happens at older ages? Same if higher mortality group has smaller frailty variance? (Homework: prove this, simulate this. see if cross of is when cumulative hazards satisfy the condition at the end of 5E). (* problem. can you solve for x0 in temrs of variances 1 and 2 and R with gamma gompertz?) 5.2.3 Inversion Our challenge is to invert a not easy pop hazards formula \\[ \\bar{\\mu}(x) = {\\mu_0(x) \\over 1 + \\sigma^2 H_0(x)} \\] because we have both hazards and cumulative hazards on right. Hazards are slope of log survival Recall for Gamma, \\[ \\bar{S}(x) = { 1 \\over (1 + \\sigma^2 H_0(x))^{1/\\sigma^2}} \\] We write down the hazard as the derivative of log survival \\[ \\bar{\\mu}(x) = {1 \\over \\sigma^2} {d \\over dx} \\log(1 + \\sigma^2 H_0(x)). \\] The anti-derivative of both sides, gives \\[ \\bar{H}(x) = {1 \\over \\sigma^2} \\log(1 + \\sigma^2 H_0(x)). \\] And now we have only 1 expression involving the baseline hazards on the right. Solving \\[ \\bar{H}(x) = {1 \\over \\sigma^2} \\log(1 + \\sigma^2 H_0(x)). \\] gives us the cumulative hazard \\[ H_0(x) = {1 \\over \\sigma^2} \\left(e^{\\sigma^2 \\bar{H}(x)} - 1 \\right). \\] And differencing, gives us a remarkably simple expression for the baseline hazard in terms of the observed popualtion hazard \\[ \\mu_0(x) = \\bar\\mu(x) e^{\\sigma_2 \\bar{H}(x)} \\] We don’t observe underlying baseline hazard \\(\\mu_0\\) on left What is observed (and unobserved) on right? 5.2.4 An example library(data.table) dt &lt;- fread(&quot;/hdir/0/fmenares/Book/bookdown-master/data/ITA.cMx_1x1.txt&quot;, na.string = &quot;.&quot;) my.dt &lt;- dt[Year == 1915] my.dt[, H.f := cumsum(Female)] my.dt[, H.m := cumsum(Male)] my.dt[, h.f := Female] my.dt[, h.m := Male] sigma.sq &lt;- .5^2 my.dt[, h0.f.5 := h.f * exp(sigma.sq *H.f)] my.dt[, h0.m.5 := h.m * exp(sigma.sq *H.m)] sigma.sq &lt;- .2^2 my.dt[, h0.f.2 := h.f * exp(sigma.sq *H.f)] my.dt[, h0.m.2 := h.m * exp(sigma.sq *H.m)] sigma.sq &lt;- 1^2 my.dt[, h0.f1 := h.f * exp(sigma.sq *H.f)] my.dt[, h0.m1 := h.m * exp(sigma.sq *H.m)] Italian Females, born 1915 (\\(\\sigma^2 = .2^2, .5^2, 1^2\\)) par(mfrow = c(1,2)) foo &lt;- my.dt[, plot(Age, H.f, col = &quot;red&quot;)] title(&quot;Cumulative Hazards\\n Italian Females born 1915&quot;) foo &lt;- my.dt[, plot(Age, log(h.f), type = &quot;l&quot;, ylim = c(-7, 2), col = &quot;red&quot;, main = &quot;Observed vs. implied baseline&quot;)] foo &lt;- my.dt[, lines(Age, log(h0.f.2), lty = 2, col = &quot;red&quot;)] foo &lt;- my.dt[, lines(Age, log(h0.f.5), lty = 3, col = &quot;red&quot;)] foo &lt;- my.dt[, lines(Age, log(h0.f1), lty = 4, col = &quot;red&quot;)] legend(&quot;topleft&quot;, legend = c(&quot;baseline&quot;, &quot;obs if s2 = .2^2&quot;, &quot;obs if s2 = .5^2&quot;, &quot;obs if s2 = 1^2&quot;), col = &quot;red&quot;, lty = 1:4) Italian Females vs Males born 1915 (\\(\\sigma^2 = .5^2\\)) par(mfrow = c(1,2)) ## title(&quot;Cumulative Hazards\\n Italian Females born 1915&quot;) foo &lt;- my.dt[, plot(Age, log(h.f), type = &quot;l&quot;, ylim = c(-7, 2), col = &quot;red&quot;, main = &quot;Observed vs. implied baseline&quot;)] foo &lt;- my.dt[, lines(Age, log(h0.f.5), lty = 2, col = &quot;red&quot;)] ugh &lt;- my.dt[, lines(Age, log(h.m), type = &quot;l&quot;, col = &quot;blue&quot;)] ugh &lt;- my.dt[, lines(Age, log(h0.m.5), lty = 2, col = &quot;blue&quot;)] legend(&quot;topleft&quot;, legend = c(&quot;female observed&quot;, &quot;female baseline&quot;, &quot;male observed&quot;, &quot;male baseline&quot;), col = c(&quot;red&quot;,&quot;red&quot;, &quot;blue&quot;, &quot;blue&quot;), lty = c(1,2, 1,2)) ## now do difference foo &lt;- my.dt[, plot(Age, h.m/h.f, type = &quot;l&quot;, col = &quot;black&quot;, ylab = c(&quot;h.m/h.f&quot;), main = &quot;Male-female hazard ratio&quot;)] foo &lt;- my.dt[, lines(Age, h0.m.5/h0.f.5, lty = 2)] legend(&quot;topright&quot;, legend = c(&quot;observed&quot;, &quot;implied baseline&quot;), ## col = c(&quot;red&quot;,&quot;blue&quot;), lty = 1:2) Much bigger convergence in ``observed’’ than in baseline 5.2.5 Application 5.3 Student Presentation "],
["mortality-plateaus.html", "Chapter 6 Mortality plateaus 6.1 Outline 6.2 Heterogeneity slows mortality improvement 6.3 Conclusions 6.4 Ken’s class", " Chapter 6 Mortality plateaus 6.1 Outline Math Ken’s class Presentation 6.2 Heterogeneity slows mortality improvement Define \\(\\rho(x,t)\\) be the rate of mortality \\[ \\rho(x,t) = - {d \\over dt} \\log \\bar\\mu(x,t) \\] Extending our gamma result for 1 cohort to the surface, \\[ \\bar\\mu(x,t) = \\mu_0(x,t) \\bar{S}_c(x,t)^{\\sigma^2} \\] We take the log and the time-derivative of hazards give (39^*) \\[ \\rho(x,t) = \\rho_0(x,t) - \\sigma^2 {d \\over dt} \\log \\bar{S}_c(x,t)^{\\sigma^2} \\] So individual risks from one cohort to the next are going down faster it seems. Intuition? 6.2.1 An example Assume \\(\\sigma^2 = .2\\). library(data.table) sigma.sq = .2 dt &lt;- fread(&quot;/hdir/0/fmenares/Book/bookdown-master/data/ITA.bltcoh_1x1.txt&quot;, na.string = &quot;.&quot;) mx.80.c1880 &lt;- dt[Year == 1880 &amp; Age == &quot;80&quot;]$mx mx.80.c1900 &lt;- dt[Year == 1900 &amp; Age == &quot;80&quot;]$mx (rho.bar.80 &lt;- -log(mx.80.c1900/mx.80.c1880)/20) ## about 0.8% ## [1] 0.008729961 Sx.80.c1880 &lt;- dt[Year == 1880 &amp; Age == &quot;80&quot;]$lx Sx.80.c1900 &lt;- dt[Year == 1900 &amp; Age == &quot;80&quot;]$lx (d.log.Sx &lt;- log(Sx.80.c1900/Sx.80.c1880)/20) ## [1] 0.02177952 (rho.0.80 = rho.bar.80 + sigma.sq * d.log.Sx) ## about 1.3% ## [1] 0.01308586 So mortality progress is more than 50% faster than it appears! Issues? 6.3 Conclusions Gamma frailty gives simple expressions for population survival, hazard, and average frailty. Gamma frailty gives a plateau Gamma frailty gives us a predicted rate of convergence and cross-over with age All of this means it is a useful null model. Takes us away from “it could be selection” to “what if it were selection” 6.4 Ken’s class Giving the result "],
["tempo.html", "Chapter 7 Tempo 7.1 Outline 7.2 Summary 7.3 Fertility postponement, a very simple example 7.4 Period Shifts: Bongaarts and Feeney’s model 7.5 A derivation: due to Rodriguez 7.6 ``Uniform’’ shifts 7.7 BF recommendation for achieving uniformity 7.8 An Application to the United States 7.9 Two Americas 7.10 Conclusions", " Chapter 7 Tempo 7.1 Outline A tempo simulation Bongaarts and Feeney’s formula An application to the United States Two Americas? EM algorithm for unmixing mixtures An application to two Americas. 7.2 Summary 7.2.1 What we see is superficial. Heterogeneous models reveal what’s ``really’’ going on. (Or do they?) Until today, population hazards mislead Today, homogeneous fertility misleads 7.2.2 Wwill reverse perspectives We see differences we see in genotypes, in lineages, in names. These could be due to ``real’’ differences (heterogeneity). But they could also be due to luck. Everyone is the same but stochastic outcomes differ. Our models of individual-level randomness will have predicted dynamics, which are themselves interesting but can also be used as a ``null’’ to compare to observations. 7.3 Fertility postponement, a very simple example Baseline A population has a history of 1 birth per day When women turn age 25, they have a daughter. This gives us a constant stream of births, 365 per year. Postponement Starting on Jan. 1, 020, everyone postponements childbearing an additional month, until they are aged 25 1/12. How many births will there be in 2020? How many births in 2021? 7.3.1 Continuous postponement, a shiny simulation [\\(R(t)\\)] Cumulative postponment -[\\(r(t)\\)] Incremental postponement \\(r(t) = R&#39;(t)\\) What is a formula for recovering original birth stream? \\[ \\hat{B}_{orig} = B_{obs} \\times (1 + R&#39;(t)) \\] or \\[ \\hat{B}_{orig} = B_{obs} \\times 1/ \\left[1 - R&#39;(t)\\right]? \\] Note: this idea of ``recovering original’’ is one way to think about tempo adjustment. A bigger microsimulation Each period will have births across a range of ages We’ll randomly generate the original planned birthdays Then we’ll shift by a continuous function \\(R(t)\\). 7.4 Period Shifts: Bongaarts and Feeney’s model \\[ f(a,t) = f_0(a - R(t)) (1- R&#39;(t)) q(t) \\] -[\\(f(a,t)\\)] birth rate of women aged \\(a\\) in period \\(t\\) -[\\(f_0\\)] A constant baseline schedule (can be norm’d to sum to 1). -[\\(q(t)\\)] A period intensity parameter: ``quantum’’ -[\\(R(t)\\)] Cumulative shift. 7.4.1 An example \\[ f(a,t) = f_0(a - R(t)) (1- R&#39;(t)) q(t) \\] \\(R_{2019} = 3\\) \\(R&#39;_{2019} = .1\\) \\(q(2019) = 1\\) Give an expression for \\(f(28,2019)\\). 7.5 A derivation: due to Rodriguez Assume no quantum effects. Take a cohort with cumulative fertility \\[ F_0(a) = \\int_0^a f(x) \\,dx \\] Now put in shifts so that observed fertility is from an age \\(R(t)\\) years . (28'' is the new25’’!) \\[ F(a,t) = F_0(a - R(t)) \\pause = F_0(a - R(c + a)) \\] Differentiate with respect to age (which for a cohort is also time \\(t\\)), using chain rule \\[ f(a,t) = f_0(a - R(t)) \\left[1 - R&#39;(t)\\right] \\] Bingo! 7.5.1 Quantum comes at the end Let’s re-notate our constant quantum result \\[ f_0(a,t | R(t) ) = f_0(a - R(t)) \\left[1 - R&#39;(t)\\right] \\] Then we can incorporate period quantum on the shifted surface: \\[ f(a,t) = f_0(a,t | R(t) ) q(t) = f_0(a - R(t)) \\left[1 - R&#39;(t)\\right]q(t) \\] Note: If we vary quantum shifts, then \\(q(t)\\) will bleed into neighboring years. (a small effect, but makes model messier). 7.5.2 Tempo-adjusted TFR: counter-factual, TFR in absence of timing changes \\[ TFR(t) = \\int_0^\\infty f(a,t) \\, da \\] Substituting our shifted birth rates with quantum \\[ TFR(t) = \\int_0^\\infty f_0(a - R(t)) \\left[1 - R&#39;(t)\\right]q(t) \\] gives? \\[ TFR(t) = TFR_0 \\left[1 - R&#39;(t)\\right] q(t) \\] WLG, define \\(TFR_0 = 1\\), then \\[ q(t) = \\alert{ {TFR(t) \\over 1 - R&#39;(t)} \\equiv TFR^*(t) } \\] Voila, the BF formula 7.5.3 How do period schedules change? For homework \\[ f(a,t) = f_0(a - R(t)) \\left[1 - R&#39;(t)\\right] \\] What does \\[ {\\partial \\over \\partial t} \\log f(a,t) = ? \\] Let’s sketch 7.6 ``Uniform’’ shifts BF model assumes all ages shift by \\(R(t)\\). BF model assumes all ages rise or fall by same quantum \\(q(t)\\) Violating these assumptions means change in mean age will not just reflect ``tempo’’. Example: What happens if people have fewer higher order births? 7.7 BF recommendation for achieving uniformity Separate estimates for each birth order, and then combine: \\[ TFR^*(t) = \\sum_i TFR_i^*(t) = \\sum_i {TFR_i(t) \\over 1 - r_i(t)} \\] This will protect against order-specific quantum effects. 7.8 An Application to the United States We’ll use HFD data We’ll do tempo adjustment for all births We’ll redo by birth order ## Tempo adjustment of US fertility using HMD data and ## Bongaarts-Feeney formula library(data.table) source(&quot;/hdir/0/fmenares/Book/bookdown-master/codes/tempo_functions.R&quot;) source(&quot;/hdir/0/fmenares/Book/bookdown-master/codes/utility_functions.R&quot;) ## (1) read in data and format into an array ## (2) fit bongaarts feeney without birth order ## (3) fit bongaarts feeney with birth order ## (1) read in data and format into an array ## age specific fertility rates by birth order for all countries and times ## RR means &quot;rectangles&quot; on Lexis surface dt &lt;- fread(&quot;/hdir/0/fmenares/Book/bookdown-master/data/zip_w/asfrRRbo.txt&quot;) dt &lt;- dt[Code == &quot;USA&quot;] ## keep only US ## keep only ages 15 to 49 dt &lt;- dt[Age %in% 15:49] print(dt) ## Code Year Age ASFR ASFR1 ASFR2 ASFR3 ASFR4 ASFR5p ## 1: USA 1933 15 0.00672 0.00647 0.00025 0.00000 0.00000 0.00000 ## 2: USA 1933 16 0.01875 0.01744 0.00121 0.00009 0.00000 0.00000 ## 3: USA 1933 17 0.03846 0.03337 0.00464 0.00038 0.00005 0.00002 ## 4: USA 1933 18 0.06586 0.05150 0.01256 0.00154 0.00021 0.00004 ## 5: USA 1933 19 0.08719 0.05946 0.02249 0.00446 0.00064 0.00014 ## --- ## 2971: USA 2017 45 0.00189 0.00048 0.00045 0.00032 0.00023 0.00041 ## 2972: USA 2017 46 0.00102 0.00028 0.00026 0.00016 0.00012 0.00019 ## 2973: USA 2017 47 0.00059 0.00019 0.00015 0.00009 0.00005 0.00010 ## 2974: USA 2017 48 0.00029 0.00010 0.00008 0.00004 0.00002 0.00005 ## 2975: USA 2017 49 0.00023 0.00008 0.00005 0.00004 0.00002 0.00003 ## put all order fertiility into a matrix fat &lt;- dt[, xtabs(ASFR ~ Age + Year)] fat &lt;- as.matrix(unclass(fat)) ## may cause problems, we&#39;ll see fat1 &lt;- dt[, xtabs(ASFR1 ~ Age + Year)] fat2 &lt;- dt[, xtabs(ASFR2 ~ Age + Year)] fat3 &lt;- dt[, xtabs(ASFR3 ~ Age + Year)] fat4 &lt;- dt[, xtabs(ASFR4 ~ Age + Year)] fat5p &lt;- dt[, xtabs(ASFR5p ~ Age + Year)] year.vec &lt;- colnames(fat) age.vec &lt;- rownames(fat) parity.vec &lt;- c(&quot;all&quot;, 1:5) fat.array &lt;- array(NA, dim = c(nrow(fat), ncol(fat), length(parity.vec))) dimnames(fat.array) &lt;- list(age.vec, year.vec, parity.vec) fat.array[,,&quot;all&quot;] &lt;- fat fat.array[,,&quot;1&quot;] &lt;- fat1 fat.array[,,&quot;2&quot;] &lt;- fat2 fat.array[,,&quot;3&quot;] &lt;- fat3 fat.array[,,&quot;4&quot;] &lt;- fat4 fat.array[,,&quot;5&quot;] &lt;- fat5p ## (2) fit bongaarts feeney tfr.vec &lt;- colSums(fat) ## (2a) by hand mu.vec &lt;- apply(fat, 2, get.mean) rt.vec &lt;- center.diff(mu.vec) adj.tfr.vec &lt;- tfr.vec / (1 - rt.vec) par(mfrow = c(3,1)) plot(names(mu.vec), mu.vec) plot(names(mu.vec), rt.vec) abline(h =0) plot(year.vec, tfr.vec, type = &quot;l&quot;) lines(year.vec, adj.tfr.vec, lty = 2) abline(v = c(1945, 2008)) ## we see fertility since 1980 has been depressed by postponment ## we see weird dynamics around end of WW2 and great recession. ## what&#39;s going on? par(mfrow = c(1,1)) plot(year.vec, tfr.vec, type = &quot;l&quot;) lines(year.vec, adj.tfr.vec, lty = 2) abline(v = c(1945, 2008)) abline(h = seq(1.5, 2.5, .1), col = &quot;grey&quot;, lty = 3) ## can also use function to fit adj.tfr.vec.from.fun &lt;- bf.fit.simple(fat)$tfr.star lines(year.vec, adj.tfr.vec.from.fun, col = &quot;red&quot;) ## Now let&#39;s look at turbulence around WW2 par(mfrow = c(2,2)) plot(age.vec, fat[,&quot;1944&quot;], type = &quot;l&quot;, ylim = c(0, .23), ylab = &quot;f(a)&quot;, xlab = &quot;age a&quot; ) lines(age.vec, fat[,&quot;1945&quot;], type = &quot;l&quot;, col = &quot;red&quot;) lines(age.vec, fat[,&quot;1946&quot;], type = &quot;l&quot;, col = &#39;orange&#39;) lines(age.vec, fat[,&quot;1947&quot;], type = &quot;l&quot;, col = &quot;blue&quot;) legend(&quot;topright&quot;, legend = 1944:1947, col = c(&quot;black&quot;, &quot;red&quot;, &quot;orange&quot;, &quot;blue&quot;), lty = 1) title(&quot;Age specific fertility&quot;) ## plot(1943:1947, mu.vec[paste(1943:1947)], ylab = &quot;mu(t)&quot;, xlab = &quot;t&quot;, col = c(&quot;black&quot;, &quot;black&quot;, &quot;red&quot;, &quot;orange&quot;, &quot;blue&quot;), pch = 19) title(&quot;Mean ages&quot;) ## plot(1943:1947, rt.vec[paste(1943:1947)], ylab = &quot;r(t)&quot;, xlab = &quot;t&quot;, col = c(&quot;black&quot;, &quot;black&quot;, &quot;red&quot;, &quot;orange&quot;, &quot;blue&quot;), pch = 19) title(&quot;Changes in mean, centered&quot;) ## plot(1943:1947, tfr.vec[paste(1943:1947)], ylab = &quot;tfr&quot;, xlab = &quot;t&quot;, ylim = c(1, 4), type = &quot;l&quot;) lines(1943:1947, adj.tfr.vec[paste(1943:1947)], lty = 2) title(&quot;TFR and adjTFR&quot;) ## From 1945 to 1946, fertility goes up a lot, but more at younger ## ages. So mean goes down. BF adjustment over-compensates, and has ## quantum declining. ## What&#39;s happening from 1944-45? ## (3) fit bongaarts feeney with birth order out &lt;- bf.fit(fat.array) adj.tfr.bo.vec &lt;- out$tfr.star.out[, &quot;bf.tfr.star&quot;] ## pdf(&quot;usa_tempo_fig.pdf&quot;) par(mfrow = c(1,1)) plot(year.vec, tfr.vec, type = &quot;l&quot;, lwd = 2) lines(year.vec, adj.tfr.vec, lty = 2) lines(year.vec, adj.tfr.bo.vec, lty = 1, lwd = 2, col = &quot;red&quot;) ## let&#39;s check against hfd hfd.adj.dt &lt;- fread(&quot;/hdir/0/fmenares/Book/bookdown-master/data/zip_w/adjtfrRR.txt&quot;, skip = 2) hfd.adj.dt &lt;- hfd.adj.dt[Code == &quot;USA&quot;] hfd.adj.dt[, points(Year, adjTFR, col = &quot;red&quot;, cex = .8)] ## NULL legend(&quot;topright&quot;, c(&quot;tfr&quot;, &quot;tfr* (all parities)&quot;, &quot;tfr* (by parity)&quot;), col = c(&quot;black&quot;, &quot;black&quot;, &quot;red&quot;), lty = c(1, 2, 1), lwd = c(2,1,2)) hfd.adj.dt[, lines(Year, filter(adjTFR, rep(1/7, 7)), col = &quot;red&quot;, lwd = 4)] ## NULL ## dev.off() ## Q. Does taking birth order into account smooth WW2 turbulence? ## Q. Does taking birth order into account smooth Recession turbulence? ## Q. Does taking birth order into account, retell the baby boom? ## Q. Does taking birth order into account, retell the baby bust? Baby boom smaller if we account for ``pre-ponement’’. Fertility lull in 1970s and 80s disappears if we account for ``postponement’’ Birth order disaggregation improves estimates of shifts from changes in mean age What happened with the recession? 7.9 Two Americas Let’s look at births (all orders). fat_movie.pdf Let’s look at 1st births, again as if their are two latent groups: \\(A\\) and \\(B\\). (These could be early moms'' /late moms’’, non-college / college, pre-marital / marital, lower-class / upper class, \\(\\ldots\\)) fat_mix_movie.pdf library(mixtools) ## simulate 2 normals N &lt;- 1000 x1 &lt;- rnorm(N, mean = 22, sd = 3) ## x2 &lt;- rnorm(2*N, mean = 30, sd = 4) ## combine them x &lt;- c(x1,x2) ## use EM to infer mixture out &lt;- normalmixEM(x, lambda = c(.5, .5), mu = c(15, 35), sigma = c(5,5)) ## number of iterations= 489 print(out$mu) ## [1] 22.67040 30.49742 print(out$sigma) ## [1] 3.301363 3.801764 print(out$lambda) ## [1] 0.4032589 0.5967411 Seems to work great. ages &lt;- 10:49 dens1 &lt;- dnorm(x = ages, mean = out$mu[1], sd = out$sigma[1]) * out$lambda[1] dens2 &lt;- dnorm(x = ages, mean = out$mu[2], sd = out$sigma[2]) * out$lambda[2] par(mfrow = c(1,1)) hist(x, probability = T, col = &quot;grey&quot;) lines(ages, dens1, col = &quot;red&quot;, lwd = 2) lines(ages, dens2, col = &quot;blue&quot;, lwd = 2) lines(ages, dens1 + dens2, col = &quot;black&quot;, lwd = 2) 7.9.1 An algorithm for tempo adjustment of mixtures Fit normal mixture to each year. Refit using constant variance (average). This assures shape invariance of each component, fulfilling BF assumption. Estimate BF separately for \\(A\\) and \\(B\\), and combine. tempo_mixed_results_figure.pdf Identifiability? % could do with 3 sub-populations? 7.10 Conclusions Postponement dilutes period births, lowers TFR Tempo-adjustment tries to ``put births back in’’ Changes in mean work fine if ``shape’’ doesn’t change Shape can change through heterogeneity With strong assumptions, we can identify heterogeneity Declining quantum for young and postponement for old appears to be the story 7.10.1 Caveats Who are these latent groups? Do you start out in one and end up in the other? Do you stay in one your whole life? How do we project forward? Can we use other indicators (e.g., social class, education, marriage) to get same results? "],
["branching-processes.html", "Chapter 8 Branching Processes 8.1 Outline 8.2 Motivation 8.3 Simulated examples and the questions they raise 8.4 What is a (Bienaym'e-)Galton-Watson branching process? 8.5 Simulations 8.6 “Extinction” vs “breakout” 8.7 Good and bad set-ups for branching process", " Chapter 8 Branching Processes 8.1 Outline The Galton-Watson-Bienaym'e Process A viral example, simulating a branching process, our questionsThe distribution of the 2nd generation Moment generating functions Extinction probabilities The distribution of offspring of all generations A tractable offspring distribution 8.2 Motivation Until now, we’ve focused on the hidden structures of heterogeneity. Now, we’re switching gears: Stochastic not deterministic In small populations, randomness matters. (Even when risks are homogeneous.) branching processes (“parents producing children”), next Fisher-Wright (“children choosing parents”), and then historical reconstruction from contemporary diversity (“coalescent”). 8.2.1 Very brief history of Branching Processes Bienayme’s lost notes Galton and Watson’s (extinction of families) old motivation: to see if elites were dying out because of “degeneration” Genetics (survival of a mutant) contemporary motivation: evolution and neutral genetic change. what is the chance that a mutant will survive? The bomb (chain reactions) war-time motivation: to see how to build the bomb Anywhere “incipient dynamics” matter. sociological: will all of S. Korea be “Kim”? can we get variance of repro success from name disn? it will give us a headstart on other (less realistic but easier) “drift” models. 8.2.2 Applicability to the Coronavirus? Yes and no. Perhaps the beginning, with first few cases. But once scale gets large, we’ll see that deterministic dynamics take over. One lesson: beyond \\(R_0\\). 8.3 Simulated examples and the questions they raise 8.3.1 Our viral example Here are the chances that the first carrier passes on the virus to \\(k\\) people? \\(k\\) \\(p_k\\) digits 0 .3 0-2 1 .4 3-5 2 .3 6-9 What is \\(R_0\\), (aka \\(m\\))? Calculate. Let’s diagram one chance outcome, using my number “(xxx) xxx-9056” \\(k\\) \\(p_k\\) digits 0 .3 0-2 1 .4 3-5 2 .3 6-9 8.4 What is a (Bienaym'e-)Galton-Watson branching process? \\(p_k\\): Each individual in each generation reproduces independently, following same offspring distribution, with \\(p_k\\) as the probability of having \\(k\\) offspring. \\(Z_n\\): The si\\(Z\\)e of the \\(n\\)’th generation \\(Z_n\\). (\\(Z_1 \\equiv 1\\)) \\(p_0 &gt; 0\\): Some non-zero probability of no children. Variance: None of the \\(p_k\\) are 1 Some questions Galton’s original question What is the chance \\(d\\) of eventual extinction (no “outbreak”)? Or, what is the distribution of surviving family sizes? What are the aggregate properties of many branching processes? (Mean growth, variance, time-paths, eventual size)? 8.5 Simulations k = 0:2 p0 = .3; p1 = .3; p2 = .4; p_k = c(p0, p1, p2) Z1 = 1 set.seed(9) (kids.of.Z1 = sample(x = k, size = Z1, replace = T, prob = p_k)) ## [1] 2 (Z2 = sum(kids.of.Z1)) ## [1] 2 (kids.of.Z2 = sample(x = k, size = Z2, replace = T, prob = p_k)) ## [1] 2 2 (Z3 = sum(kids.of.Z2)) ## [1] 4 (kids.of.Z3 = sample(x = k, size = Z3, replace = T, prob = p_k)) ## [1] 2 1 2 2 (Z4 = sum(kids.of.Z3)) ## [1] 7 Let’s draw the tree. / // // / #A function branch &lt;- function(n_max = 30, pk = c(p0, p1, p2), Z1 = 1) { Z.vec &lt;- rep(NA, n_max) Z.vec[1] &lt;- Z1 for (i in 1:(n_max-1)) { Z.vec[i+1] &lt;- sum(sample(x = k, size = Z.vec[i], replace = T, prob = p_k)) } return(Z.vec) } set.seed(19); branch() ## [1] 1 2 2 4 5 2 2 3 2 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 set.seed(99); branch() ## [1] 1 1 2 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 Let’s see what happens with 20 trials (up to 30 generations) n_trials = 20; n_gen = 30 Z.mat &lt;- matrix(NA, n_trials, n_gen) set.seed(131) for (i in 1:n_trials) Z.mat[i,] &lt;- branch(n_max = n_gen) matplot(t(Z.mat), type = &quot;l&quot;, lty = 1, ylab = &quot;Zn&quot;, xlab = &quot;n&quot;) How many survive (out of 20)? log-scale suppressWarnings(matplot(t(Z.mat), log = &quot;y&quot;, type = &quot;l&quot;, lty = 1, ylab = &quot;Zn&quot;, xlab = &quot;n&quot;)) surviving = ifelse(Z.mat[,n_gen] == 0, &quot;extinct&quot;, &quot;survive&quot;) foo &lt;- prop.table(table(surviving)) print( prop.table(table(surviving)) ) ## surviving ## extinct survive ## 0.5 0.5 How would you discribe the time path of the surviving lines? Long term n_trials = 20; n_gen = 100 Z.mat &lt;- matrix(NA, n_trials, n_gen) set.seed(131) for (i in 1:n_trials) Z.mat[i,] &lt;- branch(n_max = n_gen) suppressWarnings(matplot(t(Z.mat), log = &quot;y&quot;, type = &quot;l&quot;, lty = 1, ylab = &quot;Zn&quot;, xlab = &quot;n&quot;)) What does this remind you of? (Hint: “Leslie”). (See Harris figure) 8.6 “Extinction” vs “breakout” We see that in a super-critical (\\(m &gt; 1\\)) branching process, if a line can survive a few generations and reach a large enough size, it will grow exponentially. What happens if \\(m &lt; 1\\), if \\(m = 1\\)? Discuss. 8.6.1 The Probability Generating Function: Our mathematical tool \\[ h(z) = p_0 + p_1 z + p_2 z^2 + \\ldots \\] The PGF “keeps book” on the probabilities. The chance of \\(k\\) is the coefficient on \\(z^k\\). -$h(0) = $ -$h(1) = $ -$h’(1) = $ The story of two brothers A father has two sons. The probability generating function of their children combined is: \\[ [h(z)]^2 = (p_0 + p_1 z + p_2 z^2) \\times (p_0 + p_1 z + p_2 z^2) \\] Multiply out, and tell me the coefficients on $z^0, z^1, $. What is the probability generating function for the distribution of grandsons? A man has two sons, with probability \\(p_2\\), so PGF in that case is $ p_2 [h(z)]^2 $. But let’s sum over all possible numbers of sons. \\[ p_0 + p_1 h(z) + p_2 [h(z)]^2 + p_3 [h(z)]^3 + \\ldots \\] Which is? (Hint: write a new argument for PGF) \\[ h(h(z)) \\] Can show PGF for the n’th generation is \\[ h(h(h ... \\mbox{$n$ times} h(z))) = h_n(z) \\] exercise: write out \\(h_2(z) = h(h(z))\\) for \\[ h(z) = p_0 + p_1 z + p_2 z^2. \\]} Extinction -“Extinction is forever.”: So, the probability \\(d_n\\) of extinction {} generation \\(n\\) can never decline over time. (Must it always rise?) Recursive extinction -Is non-extinction “forever”?: If \\(\\lim_{n \\rightarrow \\infty} = d(\\infty) &lt; 1\\), then this says there’s a chance \\(1 - d(\\infty)\\) of eternal persistence. We’ll try to figure out more about what this means. If the probability of a female line going extinct in \\(n\\) generations is \\(d_n\\), then this is equivalent to her daughter(s) line(s) going extinct in \\(n-1\\) generations. With \\(p_k\\) chance of having \\(k\\) daughters, we have \\[ d_n = p_0 + p_1 d_{n-1} + \\mbox{What is next term in series?} \\] What can we do with \\[ d_n = h(d_{n-1})? \\] Well, remember that \\(d_n\\) is non-decreasing, and that it’s maximum can be no greater than \\(1.0\\). When \\(d_n\\) reaches it’s limit, say \\(d\\), we won’t need generational subscripts, \\(d\\) will be constant, and will obey \\[ d = h(d) \\] Thus, an amazing result: the probability of ultimate extinction is when the argument equals the PGF of the argument. Can \\(d = 1\\), can \\(d &lt; 1\\) Try \\(d = 1\\). What happens? If we were to find a solution less than 1.0, how would we interpret that? Three cases par(mfrow = c(1,3), pty = &quot;s&quot;) z = seq(0, 1.6, .01) pk = c(.3, .0, .7); names(pk) &lt;- 0:2 d &lt;- pk[&quot;0&quot;] for (i in 1:10) { d &lt;- pk[&quot;0&quot;] + pk[&quot;1&quot;]*d + pk[&quot;2&quot;]*d^2 } ## super-critical hz = pk[&quot;0&quot;] + pk[&quot;1&quot;]*z + pk[&quot;2&quot;]*z^2 plot.fun &lt;- function(z, hz) { plot(z, hz, type = &quot;l&quot;, ylim = c(0,1.6), ylab = &quot;h(z)&quot;, yaxs = &quot;i&quot;, xaxs = &quot;i&quot;, axes = F) axis(1, at = seq(0, 1.5, .5)) axis(2, at = seq(0, 1.5, .5)) abline(0,1, col = &quot;grey&quot;) lines(z, hz) axis(2, at = pk[&quot;0&quot;], labels = &quot;p0&quot;, col.axis = &quot;red&quot;, col = &quot;red&quot;, lwd = 1, las = 2) } plot.fun(z,hz) points(c(d, 1),c(d, 1)) title(&quot;Super-critical (m &gt; 1) \\n 2 roots&quot;) ## sub-critical pk = c(.3, .55, .15); names(pk) &lt;- 0:2 hz = pk[&quot;0&quot;] + pk[&quot;1&quot;]*z + pk[&quot;2&quot;]*z^2 plot.fun(z,hz) title(&quot;Sub-critical (m &lt; 1) \\n 1 root&quot;) points(1,1) ## critical pk = c(.3, .4, .3); names(pk) &lt;- 0:2 hz = pk[&quot;0&quot;] + pk[&quot;1&quot;]*z + pk[&quot;2&quot;]*z^2 plot.fun(z, hz) title(&quot;Critical (m = 1), \\n 1 root&quot;) points(1,1) We can prove by answering: What is \\(h&#39;(1)\\)? What is \\(h(0)\\)? Is \\(h&#39;&#39;(z) &gt; 0\\)? pk = c(.3, .0, .7); names(pk) &lt;- 0:2 z = seq(0, 1.6, .01) hz = pk[&quot;0&quot;] + pk[&quot;1&quot;]*z + pk[&quot;2&quot;]*z^2 plot.fun(z,hz) Where is \\(h(p_0)\\), \\(h(h(p_0))\\), \\(h(h(h(p_0)))\\), \\(\\ldots\\)? So how do we actually get \\(d\\)? Take the case where \\(p_0 = .3\\), \\(p_1 = 0\\), and \\(p_3 = .7\\) (the one I just plotted). Can do some algebra Or we can recursively iterate on the computer. Numerical recursion pk = c(.3, .0, .7); names(pk) &lt;- 0:2 ## our example d &lt;- pk[&quot;0&quot;] # initial value for (i in 1:20) { d &lt;- pk[&quot;0&quot;] + pk[&quot;1&quot;]*d + pk[&quot;2&quot;]*d^2 if (i %in% c(1,2,19,20)) print(paste(i, d)) } ## [1] &quot;1 0.363&quot; ## [1] &quot;2 0.3922383&quot; ## [1] &quot;19 0.428565882081349&quot; ## [1] &quot;20 0.428568100698915&quot; Did we get the right value? pk = c(.3, .0, .7); names(pk) &lt;- 0:2 z = seq(0, 1.6, .01) hz = pk[&quot;0&quot;] + pk[&quot;1&quot;]*z + pk[&quot;2&quot;]*z^2 plot.fun(z,hz) abline(h = d, col = &quot;green&quot;) abline(v = d, col = &quot;green&quot;) Extinction and non-extinction revisited If \\(m &gt; 1\\), there exists \\(d\\) bigger than 0 and less than unity. This means there’s some positive chance of extinction. But also some chance of never-extinction. (What form does never-extinction take?) suppressWarnings(matplot(t(Z.mat), log = &quot;y&quot;, type = &quot;l&quot;, lty = 1, ylab = &quot;Zn&quot;, xlab = &quot;n&quot;)) Relevance to Corona virus? 8.7 Good and bad set-ups for branching process .column-left{ float: left; width: 50%; text-align: left; } .column-right{ float: right; width: 50%; text-align: left; } Good Unrestricted growth (frontier, new disease, start of a reaction) A “null” model for understanding how apparent structure is just random outcomes. Families that die out didn’t have to have low \\(NRR\\). Just because most new viruses don’t break out, doesn’t mean they aren’t potentially dangerous (\\(R_0 &gt;&gt; 1.0\\)). A model that corresponds our mental model of running a generative process forward. (cf. Fisher-Wright) Bad When offspring of 1 depends on offspring of other (e.g., brothers inheriting a farm) When resource constraints slow growth rates (e.g., Malthus: fertility of next gen depends on fertility of last; SIR model in disease spread) Analysis. PGF is powerful but still we often have to deal with listing all possibilities. Big populations – law of large numbers means randomness doesn’t matter. \\begin{frame}fragile{Our set-up (note: code is revised slightly)} &lt;&lt;echo = T, size = “small”&gt;&gt;= branch &lt;- function(n_max = 30, p_k = c(p0, p1, p2), Z1 = 1) { ## note: this returns 0s when extinct k &lt;- 0:(length(p_k)-1) Z.vec &lt;- rep(NA, n_max) Z.vec[1] &lt;- Z1 for (i in 1:(n_max-1)) { Z.vec[i+1] &lt;- sum(sample(x = k, size = Z.vec[i], replace = T, prob = p_k)) } return(Z.vec) } p0 = .3; p1 = .4; p2 = .3 ## what is m? @ \\end{frame} \\begin{frame}fragile{1000 trials, code} &lt;&lt;echo = T, eval = F&gt;&gt;= n_trials = 1000; n_gen = 100 Z.mat &lt;- matrix(NA, n_trials, n_gen) set.seed(131) for (i in 1:n_trials) Z.mat[i,] &lt;- branch(n_max = n_gen) matplot(t(Z.mat), type = “l”, lty = 1, ylab = “Zn”, xlab = “n”) @ \\end{frame} \\begin{frame}fragile{1000 trials, picture} &lt;&lt;echo = F, eval = T, fig.height = 5&gt;&gt;= n_trials = 1000; n_gen = 100 Z.mat &lt;- matrix(NA, n_trials, n_gen) set.seed(131) for (i in 1:n_trials) Z.mat[i,] &lt;- branch(n_max = n_gen) matplot(t(Z.mat), type = “l”, lty = 1, ylab = “Zn”, xlab = “n”) @ \\end{frame} \\begin{frame}fragile{1000 trials, means} &lt;&lt;echo = T, eval = F&gt;&gt;= Zn_bar = apply(Z.mat, 2, mean) n &lt;- 1:ncol(Z.mat) proportion.zero &lt;- function(x){prop.table(table(x == 0))[“TRUE”]} d_n = apply(Z.mat, 2, proportion.zero) Z.mat.na &lt;- Z.mat; Z.mat.na[Z.mat == 0] &lt;- NA Zn_surv_bar = apply(Z.mat.na, 2, mean, na.rm = T) par(mfrow = c(1,3)) plot(n, Zn_bar, main = “Mean Zn”) plot(n, d_n, main = “Fraction extinct”) plot(n, Zn_surv_bar) ## insert code here for Zn_surv_bar.hat and add a line @ \\end{frame} \\begin{frame}fragile{1000 trials, means, picture} &lt;&lt;echo = F, eval = T, fig.height = 5&gt;&gt;= Zn_bar = apply(Z.mat, 2, mean) n &lt;- 1:ncol(Z.mat) proportion.zero &lt;- function(x){prop.table(table(x == 0))[“TRUE”]} d_n = apply(Z.mat, 2, proportion.zero) Z.mat.na &lt;- Z.mat; Z.mat.na[Z.mat == 0] &lt;- NA Zn_surv_bar = apply(Z.mat.na, 2, mean, na.rm = T) par(mfrow = c(1,3)) plot(n, Zn_bar, main = “Mean Zn”) plot(n, d_n, main = “Fraction extinct”) plot(n, Zn_surv_bar) ## insert code here for Zn_surv_bar.hat and add a line @ \\end{frame} \\begin{frame}fragile{Variance in our simulation} &lt;&lt;fig.height = 5&gt;&gt;= var_Zn = apply(Z.mat, 2, var) n &lt;- 1:ncol(Z.mat) plot(n, var_Zn) @ \\end{frame} % \\begin{frame}fragile{Distribution of \\(Z_n\\)} % &lt;&lt;fig.height = 5&gt;&gt;= % Z20 &lt;- table(table(Z.mat[,20])) % Z5 &lt;- table(table(Z.mat[,5])) % par(mfrow = c(2,2)) % plot(Z20[Z20 &lt; 100]) % plot(log(Z20[Z20 &lt; 100])) % plot(Z5[Z5 &lt; 100]) % plot(log(Z5[Z5 &lt; 100])) % @ % \\end{frame} \\begin{frame}fragile{A picture, Lotka’s parameters for 1920} &lt;&lt;fig.height = 4&gt;&gt;= b = 0.2126 ; c = 0.5893 kk = 1:10 ; p_kk = b * c^(kk-1) p0 = b/(1-c) k = c(0, kk) ; p_k = c(p0, p_kk) plot(k, p_k) @ \\end{frame} \\begin{frame}fragile{A plot of Keyfitz’s numbers for generations 1, 2, and 3. Is it exponential for \\(k &gt; 0\\)?} &lt;&lt;eval = F, echo = T, size = “tiny”&gt;&gt;= ## b = 0.2126 ; c = 0.5893 ## lotka b = 0.3666; c = .5533 ## Keyfitz (from GS) m = b / (1-c)^2 ## [1] 1.260416 d = (1 - b - c) / (c * (1-c)) #[1] 0.8185088 par(mfrow = c(1,1)) for (i in 1:3) { n = i p0_n = d * (m^n - 1)/ (m^n -d) j = kk pj_n = m^n ((1-d) / (m^n - d))^2 ((m^n - 1)/(m^n - d))^(j-1) pk_n &lt;- c(p0_n, pj_n) if (i == 1) plot(k, pk_n, type = “l”, log = &quot;&quot;) if (i &gt; 1) lines(k, pk_n, col = i) } @ \\end{frame} \\begin{frame}fragile{log scale} &lt;&lt;eval = T, echo = F, fig.height = 5&gt;&gt;= ## b = 0.2126 ; c = 0.5893 ## lotka b = 0.3666; c = .5533 ## Keyfitz (from G&amp;S) m = b / (1-c)^2 ## [1] 1.260416 d = (1 - b - c) / (c * (1-c)) #[1] 0.8185088 par(mfrow = c(1,1)) for (i in 1:3) { n = i print(n) p0_n = d * (m^n - 1)/ (m^n -d) j = kk pj_n = m^n * ((1-d) / (m^n - d))^2 * ((m^n - 1)/(m^n - d))^(j-1) pk_n &lt;- c(p0_n, pj_n) if (i == 1) plot(k, pk_n, type = “l”, log = “y”) if (i &gt; 1) lines(k, pk_n, col = i) } @ \\end{frame} % % \\begin{frame}{Let’s switch to R} % Our goal will be to see if distributions look geometric, or not. % \\end{frame} \\end{document} "]
]
