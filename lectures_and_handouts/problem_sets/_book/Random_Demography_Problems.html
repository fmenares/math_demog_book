<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Problem sets and solutions</title>
  <meta name="description" content="This groups all the problem sets and solutions for the Spring 2020 Mathematical Demography class" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Problem sets and solutions" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This groups all the problem sets and solutions for the Spring 2020 Mathematical Demography class" />
  <meta name="github-repo" content="josh-goldstein-git/random_demography" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Problem sets and solutions" />
  
  <meta name="twitter:description" content="This groups all the problem sets and solutions for the Spring 2020 Mathematical Demography class" />
  

<meta name="author" content="Summer 2020" />


<meta name="date" content="2020-06-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  


<script src="assets/jquery-2.2.3/jquery.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path=""><a href="#problem-set-1"><i class="fa fa-check"></i><b>1</b> Problem set 1</a><ul>
<li class="chapter" data-level="1.1" data-path=""><a href="#questions"><i class="fa fa-check"></i><b>1.1</b> Questions</a></li>
<li class="chapter" data-level="1.2" data-path=""><a href="#solutions"><i class="fa fa-check"></i><b>1.2</b> Solutions</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path=""><a href="#problem-set-2"><i class="fa fa-check"></i><b>2</b> Problem set 2</a><ul>
<li class="chapter" data-level="2.1" data-path=""><a href="#questions-1"><i class="fa fa-check"></i><b>2.1</b> Questions</a></li>
<li class="chapter" data-level="2.2" data-path=""><a href="#solutions-1"><i class="fa fa-check"></i><b>2.2</b> Solutions</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path=""><a href="#problem-set-3"><i class="fa fa-check"></i><b>3</b> Problem set 3</a><ul>
<li class="chapter" data-level="3.1" data-path=""><a href="#questions-2"><i class="fa fa-check"></i><b>3.1</b> Questions</a></li>
<li class="chapter" data-level="3.2" data-path=""><a href="#solutions-2"><i class="fa fa-check"></i><b>3.2</b> Solutions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path=""><a href="#problem-set-6"><i class="fa fa-check"></i><b>4</b> Problem set 6</a><ul>
<li class="chapter" data-level="4.1" data-path=""><a href="#questions-3"><i class="fa fa-check"></i><b>4.1</b> Questions</a></li>
<li class="chapter" data-level="4.2" data-path=""><a href="#solutions-3"><i class="fa fa-check"></i><b>4.2</b> Solutions</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path=""><a href="#problem-set-8"><i class="fa fa-check"></i><b>5</b> Problem set 8</a><ul>
<li class="chapter" data-level="5.1" data-path=""><a href="#problems"><i class="fa fa-check"></i><b>5.1</b> Problems</a></li>
<li class="chapter" data-level="5.2" data-path=""><a href="#solutions-4"><i class="fa fa-check"></i><b>5.2</b> Solutions</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Problem sets and solutions</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">Problem sets and solutions</h1>
<p class="author"><em>Summer 2020</em></p>
<p class="date"><em>2020-06-28</em></p>
</div>
<p>Special thank you to the Spring 2020 Mathematical Demography students for the problem set answers.</p>

<div id="problem-set-1" class="section level1">
<h1><span class="header-section-number">Chapter 1</span> Problem set 1</h1>
<div id="questions" class="section level2">
<h2><span class="header-section-number">1.1</span> Questions</h2>
<ol style="list-style-type: decimal">
<li><p>True or False? “If every part grows exponentially at its own rate, then the whole will also grow exponentially.” Explain your answer briefly.</p></li>
<li><p>List what you think are two of the best arguments in favor of doing a disaggregated projection? What are two of the best arguments in favor of doing an aggregated projection?</p></li>
<li><p>Let there be two countries: USA (<span class="math inline">\(u\)</span>) and Mexico (<span class="math inline">\(m\)</span>). Assume that in 1970, their population size (in millions) is <span class="math inline">\(K_u(1970) = 200\)</span>, <span class="math inline">\(K_m(1970) = 50\)</span> and that their growth rates are <span class="math inline">\(r_u = .0075\)</span> and <span class="math inline">\(r_m = 0.035\)</span>, respectively. Project the first few years and verify that the rate of change in the aggregate growth rate equals the variance of the growth rate. Does it matter what time points and period you consider?</p></li>
<li>Using the information from question 3, notice that the growth rate changes over the course of the 50 years, but there is a constant growth rate that will produce the exact same population after 50 years. A reasonable choice of the constant growth rate to apply is the value of the changing growth rate at year 25 (half-way through the period). We can estimate this using a Taylor series approximation: <span class="math display">\[ \bar{r}(25) \approx \bar{r}(0) + 25\bar{r}&#39;(0) + (25)^2 \bar{r}&#39;&#39;(0) \]</span>
<ol style="list-style-type: lower-alpha">
<li>Show that <span class="math inline">\(\bar{r}&#39;&#39;(t) = \bar{r}_3(t) - \bar{r}_2(t) \bar{r}(t) - 2 \bar{r}(t) \sigma^2_r(t)\)</span> \</li>
<li>Calculate the combined US-Mexico population after 50 years according to the following five (5) methods, plot the total population after 50 years according to these 5 methods on a graph.
<ol style="list-style-type: lower-roman">
<li>Dissaggregated (“true”) forecast, with each country growing at its own rate</li>
<li>Aggregated forecast, pretending it’s one country, growing at <span class="math inline">\(\bar{r}(0)\)</span>) for 50 years</li>
<li>Aggregated forecast, growing at the “true” value of <span class="math inline">\(\bar{r}(25)\)</span> for the whole period. (Use the value of <span class="math inline">\(\bar{r}(25)\)</span>) that you calculate from the disaggregated forecast)</li>
<li>Aggregated forecast, growing at the first-order Taylor series estimate of <span class="math inline">\(\bar{r}(25)\)</span> for the whole period</li>
<li>Aggregated forecast, growing at the second-order Taylor series estimate of <span class="math inline">\(\bar{r}(25)\)</span> for the whole period</li>
</ol></li>
</ol></li>
<li>For Ken’s Poisson-Exponential model,
<ol style="list-style-type: lower-alpha">
<li>What is the closed-form expression for <span class="math inline">\(\hat{r}(t)\)</span><br />
</li>
<li>What is the variance of the growth rate?<br />
</li>
<li>Write down an expression for the distortion index. What variables and parameters in the model does it depend on? Are there any variables or parameters that it doesn’t depend on? (difference of <span class="math inline">\(\bar{r}(t)\)</span> and <span class="math inline">\(\bar{r}(0)\)</span>)</li>
</ol></li>
</ol>
</div>
<div id="solutions" class="section level2">
<h2><span class="header-section-number">1.2</span> Solutions</h2>
<ol style="list-style-type: decimal">
<li><p><em>True or False? “If every part grows exponentially at its own rate, then the whole will also grow exponentially.” Explain your answer briefly.</em>
False.<br />
From Keyfitz we know that the average growth rate of a heterogeneous population is: <span class="math display">\[\bar{r}(t)=\frac{\sum_i{Q_i}{r_i}e^{r_i{t}}}{\sum_i{Q_i}e^{r_i{t}}}\]</span> Here, <span class="math inline">\(\bar{r}(t)\)</span> is not constant for all t as there is a compositional effect. This should be read as “If every part grows at a constant exponential rate, then the whole will also grow exponentially”. We could argue that only in the long term it is true.</p></li>
<li><em>List what you think are two of the best arguments in favor of doing a disaggregated projection? What are two of the best arguments in favor of doing an aggregated projection?</em>
<ol style="list-style-type: lower-alpha">
<li>Disaggregated projections:
<ol style="list-style-type: lower-roman">
<li>Reveal the “true” path, patterns of individuals different from that of the aggregate.<br />
</li>
<li>Take into account size of each sub-population, in particular the smaller ones.<br />
</li>
<li>Are more precise. Growth rates for sub-populations reflect their intrinsic characteristics, such that projections that do not use appropriate rates can lead to adverse social/policy implications.<br />
</li>
</ol></li>
<li>Aggregated projections:
<ol style="list-style-type: lower-roman">
<li>May used if a population is homogeneous rather than projecting many models for sub-populations.<br />
</li>
<li>Provide a straightforward method of obtaining overall rates rather than the group-specific rates.</li>
<li>Are easier to implement as more data available.</li>
</ol></li>
</ol></li>
<li><p><em>There are two countries, <span class="math inline">\(u\)</span> and <span class="math inline">\(m\)</span>, each with growth rates <span class="math inline">\(r_u = .0075\)</span>, <span class="math inline">\(r_m = 0.035\)</span>, and population sizes in 1970 of <span class="math inline">\(K_u(1970) = 200\)</span>, <span class="math inline">\(K_m(1970) = 50\)</span>. Use the first few years of the projection to verify that rate of change in the aggregate growth rate equals the variance of the growth rate. Does it matter what time points and period you consider?</em><br />
From the information given, we can obtain <span class="math inline">\(\bar{r}(t)\)</span> and <span class="math inline">\(\sigma_r^2(t)\)</span> by projecting each country’s population using individual rates and then obtaining the total population, <span class="math display">\[\bar{K}(t)= \sum_{i\in\{u,m\}}K_{i}(t) = \sum_{i\in\{u,m\}}K_{i}e^{r_{i} t}\]</span> Applying the formula for aggregate growth rate to the USA-Mexico case we get:
<span class="math display">\[\begin{aligned}
 \bar{r}(t) &amp; = \frac{\frac{d}{dt}\bar{K}(t)}{\bar{K}(t)}\\
 &amp; = \frac{K_u(0) r_u(t) e^{r_u(t) t} + K_m(0) r_m(t) e^{r_m(t) t}}{K_u(0) e^{r_u(t) t} + K_m(0) e^{r_m (t) t}}
 \end{aligned}\]</span> For simplicity, time 0 is the year 1970 such that the proyection goes from 1971 (t=1) until 2020 (t=50).<br />
Then, we can calculate the variance of the growth rates as:
<span class="math display">\[\begin{aligned}
 \sigma_r^2(t) &amp;= \frac{{K_u(0) e^{r_u(t) t}(r_u(t) - \bar{r}(t))^2 + K_m(0) e^{r_m(t) t}(r_m(t) - \bar{r}(t))^2}} { {K_u(0) e^{r_u(t) t} + K_m(0) e^{r_m(t) t}}} \\ 
 &amp;= \frac{K_u(t) r_u(t)^2 + K_m(t) r_u(t)^2}{K_u(t)+K_m(t)}-\bar{r}(t)^2 
 \end{aligned}\]</span>
The table below show these results for projections at the beginning and ending of a 50 year period. Overall, the time points do not matter and we can verify that <span class="math inline">\(\frac{d\bar{r}(t)}{d(t)}=\sigma_r^2(t)\)</span></p>
<table style="width:100%;">
<colgroup>
<col width="3%" />
<col width="15%" />
<col width="8%" />
<col width="8%" />
<col width="12%" />
<col width="26%" />
<col width="12%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th><span class="math inline">\(t\)</span></th>
<th><span class="math inline">\(\sigma^2_r(t)\)</span></th>
<th><span class="math inline">\(K_u(t)\)</span></th>
<th><span class="math inline">\(K_m(t)\)</span></th>
<th><span class="math inline">\(\bar{K}(t)\)</span></th>
<th><span class="math inline">\(\bar{K}(t)-\bar{K}(t-1)\)</span></th>
<th><span class="math inline">\(\bar{r}(t)\)</span></th>
<th><span class="math inline">\(\bar{r}&#39;(t)\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0.00021</td>
<td>200</td>
<td>50</td>
<td>250</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>l</td>
<td>0.000123</td>
<td>201.506</td>
<td>51.781</td>
<td>253.287</td>
<td>3.2866</td>
<td>0.0131</td>
<td></td>
</tr>
<tr class="odd">
<td>2</td>
<td>0.000125</td>
<td>203.023</td>
<td>53.625</td>
<td>256.648</td>
<td>3.3614</td>
<td>0.0132</td>
<td>0.0001</td>
</tr>
<tr class="even">
<td>3</td>
<td>0.000127</td>
<td>204.551</td>
<td>55.536</td>
<td>260.087</td>
<td>3.4385</td>
<td>0.0133</td>
<td>0.0001</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
</tr>
<tr class="even">
<td>49</td>
<td>0.000189</td>
<td>288.824</td>
<td>277.833</td>
<td>566.658</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>50</td>
<td>0.000189</td>
<td>290.998</td>
<td>287.730</td>
<td>578.728</td>
<td>12.071</td>
<td>0.0211</td>
<td></td>
</tr>
<tr class="even">
<td>51</td>
<td>0.000189</td>
<td>293.189</td>
<td>297.979</td>
<td>591.168</td>
<td>12.440</td>
<td>0.0213</td>
<td>0.0002</td>
</tr>
</tbody>
</table></li>
<li><em>Using the information from question 3, notice that the growth rate changes over the course of the 50 years, but there is a constant growth rate that will produce the exact same population after 50 years. A reasonable choice of the constant growth rate to apply is the value of the changing growth rate at year 25 (half-way through the period). We can estimate this using a Taylor series approximation:</em> <span class="math display">\[ \bar{r}(25) \approx \bar{r}(0) + 25\bar{r}&#39;(0) + (25)^2 \bar{r}&#39;&#39;(0) \]</span>
<ol style="list-style-type: lower-alpha">
<li><em>Show that <span class="math inline">\(\bar{r}&#39;&#39;(t) = \bar{r}_3(t) - \bar{r}_2(t) \bar{r}(t) - 2 \bar{r}(t) \sigma^2_r(t)\)</span></em><br />
From before, we know that for <span class="math inline">\(i\in\{u,m\}\)</span>:
<span class="math display">\[\begin{aligned}
 \sigma_r^2(t) &amp;= \bar{r}&#39;(t) \\
 &amp; = \frac{d}{dt}\left[ \frac{ \sum K_i r_i e^{r_i t}} {\sum K_i  e^{r_i t}} \right]\\
 &amp; = \frac{\sum K_i(0)r_i^2e^{r_it}} {\sum K_i(0)e^{r_it}} - \left(\frac{ \sum K_i(0)r_ie^{r_it}} {\sum K_i(0)e^{r_it}}\right)^2 \\
 &amp; = \frac{\sum K_i(0)r_i^2e^{r_it}} {\sum K_i(0)e^{r_it}} - \bar{r}^2(t) 
 \end{aligned}\]</span>
Then, we take the second derivative of the growth rate by using the quotient rule <span class="math inline">\(\left(\frac{u}{v}\right)&#39;= \frac{u&#39;v-vu&#39;}{v^2}\)</span>:
<span class="math display">\[\begin{aligned}
 \bar{r}&#39;&#39;(t) &amp;= { \frac{\left(\sum K_i(0)e^{r_it}\right)(\sum K_i(0)r_i^3e^{r_it}) -(\sum K_i(0)r_i^2e^{r_it})(\sum K_i(0)r_i e^{r_it})}  {(\sum K_i(0)e^{r_it})^2 }} - 2\bar{r}(t)\times\bar{r}&#39;(t)\\ 
 &amp;= \frac{ \sum K_i(0)r_i^3e^{r_it}} {\sum K_i(0)e^{r_it} } - \frac{ \sum K_i(0)r_i^2e^{r_it}} {\sum K_i(0)e^{r_it}}\times \frac{\sum K_i(0)r_i e^{r_it}}{\sum K_i(0)e^{r_it} } - 2\bar{r}(t)\sigma^2_r(t) \\
 &amp;= \bar{r}_3 (t) - \bar{r}_2(t)\bar{r}(t) - 2\bar{r}(t)\sigma^2_r(t)
 \end{aligned}\]</span>
where <span class="math inline">\(\bar{r}_n\)</span> is the <span class="math inline">\(n\)</span>th moment of <span class="math inline">\(\bar{r}(t)\)</span>, and it is known that <span class="math inline">\(\bar{r}&#39;(t) = \sigma^2_r(t)\)</span>.<br />
</li>
<li><em>Calculate the combined US-Mexico population after 50 years according to the following five (5) methods, plot the total population after 50 years according to these 5 methods on a graph.</em>
For the following exercises, the population is in millions.
<ol style="list-style-type: lower-roman">
<li><em>Dissaggregated (“true”) forecast, with each country growing at its own rate:</em><br />
<span class="math display">\[\begin{aligned}
 \bar{K}(2020) &amp;= K_u(2020) + K_m(2020)\\ 
 &amp;=K_u(1970) e^{(2020-1970)r_u} + K_m(1970) e^{(2020-1970)r_m}\\
 &amp;=200e^{.0075\times 50} + 50e^{.035\times 50}\\
 &amp;= 578.728 
 \end{aligned}\]</span><br />
</li>
<li><em>Aggregated forecast, pretending it’s one country, growing at <span class="math inline">\(\bar{r}(0)\)</span>) for 50 years:</em><br />
<span class="math display">\[\begin{aligned}
 \overline{r}(1970) &amp;= \frac{\sum K_i(1970)r_i e^{r_i (1970-1970)}} {\sum K_i(1970)e^{r_i (1970-1970) }}\\
 &amp;=\frac{K_u(1970)r_u + K_m(1970)r_m }{K_u(1970) + K_m(1970) }\\
 &amp; =  \frac{ 200\times .0075 + 50\times.035} {200+50 } = 0.013
 \end{aligned}\]</span>
<span class="math display">\[\begin{aligned}
 \bar{K}(2020) &amp;= \bar{K}(1970)e^{\bar{r}(1970) (2020-1970)}\\
 &amp;= 250  e^{.013\times 50} \approx 478.8852
 \end{aligned}\]</span><br />
</li>
<li><em>Aggregated forecast, growing at the “true” value of <span class="math inline">\(\bar{r}(25)\)</span> for the whole period. (Use the value of <span class="math inline">\(\bar{r}(25)\)</span>) that you calculate from the disaggregated forecast):</em>
Translating <span class="math inline">\(\bar{r}(25)\)</span> onto the 1970 timeline, we should look at <span class="math inline">\(\bar{r}(1995)\)</span>
<span class="math display">\[\begin{aligned}
 \bar{r}(1995) &amp;= \sum K_i(1970)r_i e^{r_i (1995-1970)} \over \sum K_i(1970)e^{r_i (1995-1970) }\\
 &amp; = \frac{K_u(1970)r_u e^{r_u (25)} + K_m(1970)r_m e^{r_m (25)} }{K_u(1970)e^{r_u (25)} + K_m(1970)e^{r_m (25)} }\\ 
 &amp; =\frac{200\times.0075 e^{.0075\left(25\right)}+50\times.035 e^{.035\left(25\right)}}{200 e^{.0075\left(25\right)}+50 e^{.035\left(25\right)}} \approx 0.0176632\\
 \bar{K}(2020) &amp;= 250e^{0.016632(50)} \approx 574.25316
 \end{aligned}\]</span><br />
</li>
<li><em>Aggregated forecast, growing at the first-order Taylor series estimate of <span class="math inline">\(\bar{r}(25)\)</span> for the whole period:</em><br />
<span class="math display">\[\begin{aligned}
 \sigma^2_r(1970) &amp;= \frac{K_u(1970)r_u^2 + K_m(1970)r_m^2} {K_u(1970) + K_m(1970)} - \bar{r}^2(0) \\
 &amp; =  \frac{(200)(0.0075)^2 + (50)(0.035)^2}{250}-(0.013)^2 \\
 &amp; = 0.000121 \\
 \hat{\bar{r}}(1995) &amp; \approx \bar{r}(1970) + 25\sigma^2_r(1970) =  0.016025 \\ 
 \bar{K}(2020) &amp;= 250 e^{0.016025(50)} \approx 557.0811485
 \end{aligned}\]</span><br />
</li>
<li><em>Aggregated forecast, growing at the second-order Taylor series estimate of <span class="math inline">\(\bar{r}(25)\)</span> for the whole period:</em><br />
For this exercise we need to first calculate the extra second-order term from the Taylor series, <span class="math inline">\(25^2\bar{r}&#39;&#39;(0)\)</span>:<br />
<span class="math display">\[\begin{aligned}
 \bar{r}&#39;&#39;(1970) &amp;= \frac{200(0.0075)^3+50(0.035)^3}{250} - \frac{200(0.0075)^2+50(0.035)^2}{250} \times (0.013) - 2(0.013)(0.000121)\\
 \hat{\bar{r}}(1995) &amp; \approx \bar{r}(1970) + 25\sigma^2_r(1970) +(25)^2\bar{r}&#39;&#39;(1970) \\
 &amp; =  0.01664891\\
 \bar{K}(2020) &amp;= 250 e^{0.01664891(50)} \\
 &amp; \approx 574.73337 \\
 \end{aligned}\]</span><br />
</li>
<li><em>Graphs</em><br />
There are many methods to project populations.
<img src="figures/problemset1_pp1.png" width="100%" /><img src="figures/problemset1_pp2.png" width="100%" /></li>
</ol></li>
</ol></li>
<li><em>For Ken’s Poisson-Exponential model,</em>
<ol style="list-style-type: lower-alpha">
<li><em>What is the closed-form expression for <span class="math inline">\(\hat{r}(t)\)</span></em><br />
<span class="math display">\[\begin{aligned}
 \hat{r}(t) &amp;= \frac{d}{dt}log(\hat{k})\\
 &amp;= r_0 - \alpha \lambda e^{-\alpha t}
 \end{aligned}\]</span></li>
<li><em>What is the variance of the growth rate?</em><br />
The variance of the growth rate is <span class="math inline">\(\sigma_r^2(t)\)</span>:
<span class="math display">\[\bar{r}&#39;(t)= \sigma^2_r(t) = \alpha^2\lambda e^{-\alpha t}\]</span></li>
<li><em>Write down an expression for the distortion index. What variables and parameters in the model does it depend on? Are there any variables or parameters that it doesn’t depend on? (difference of <span class="math inline">\(\bar{r}(t)\)</span> and <span class="math inline">\(\bar{r}(0)\)</span>)</em><br />
Distortion index:
<span class="math display">\[\begin{aligned}
 \bar{r}(t) - \bar{r}(0) &amp; = r_0 - \lambda \alpha e^{-\alpha t} - (r_0 - \lambda \alpha e^{0}) \\
 &amp; = \lambda \alpha - \lambda \alpha e^{-\alpha t}\\
 &amp; = \lambda \alpha(1-e^{-\alpha t})
 \end{aligned}\]</span>
Depends on <span class="math inline">\(\lambda\)</span>, <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(t\)</span>, but not <span class="math inline">\(r_0\)</span> or <span class="math inline">\(s\)</span>. That is, it depends on the the gap between growth rates, the relative population sizes, fastest growth rate, the poisson distribution parameter, but not the poisson distributed integers.</li>
</ol></li>
</ol>

</div>
</div>
<div id="problem-set-2" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> Problem set 2</h1>
<div id="questions-1" class="section level2">
<h2><span class="header-section-number">2.1</span> Questions</h2>
<ol style="list-style-type: decimal">
<li><p>True/False: The variance of the population distribution of deaths will always be larger than that of the baseline. Explain your answer briefly.</p></li>
<li><p>Use the fraily simulator to produce plots of the uniform, gamma, and U-shaped beta distribution. Describe in a sentence, each, how the population hazard behaves at older ages.</p></li>
<li><p>Does the behavior of the uniform at older ages look like a population with two (proportional) sub-groups? What do you think is driving this? (This is an open-ended question. You should feel free to use mathematics, intuition, or any other approach to answer.)</p></li>
<li><p>Does the behavior of the beta at older ages look like the gamma at older ages? What do you think is driving this? (Also open ended)</p></li>
<li><p>At what age do population hazards start to diverge from the baseline in the the three models? Is it fair to say that half the cohort has to have died before unobserved heterogeneity plays a role?</p></li>
<li><p>Extend the simulation code to include life expectancy at age x (Shown above.)</p></li>
<li><p>Extend the simulation code to include the average frailty of the surviving at age x, z(x). (Note: this requires some more difficulty programming, and I would recommend keeping your N fairly small.)</p></li>
<li><p>Extend the simulation code to histograms of frailty of survivors at different ages. Does the uniform stay uniform? How about the other distributions?</p></li>
<li><p>Use the method of completing the gamma to get the mean of the gamma distribution. (Hint: I believe there are youtube examples of this).</p></li>
<li><p>Derive V&amp;M equation 13, extending Keyfitz’s result. Did your derivation require you to assume proportional hazards; if so, where?</p></li>
<li><p>Derive V&amp;M equation 20, extending Keyfitz’s result to proportional changes in the population hazard. Did your derivation require you to assume proportional hazards; if so, where?</p></li>
<li><p>Describe a strategy for simulating cross-overs in the aggregate hazards of two groups, which have baseline hazards that don’t cross. If you want, write code and produce a plot.</p></li>
</ol>
</div>
<div id="solutions-1" class="section level2">
<h2><span class="header-section-number">2.2</span> Solutions</h2>
<ol style="list-style-type: decimal">
<li><em>True/False: The variance of the population distribution of deaths will always be larger than that of the baseline. Explain your answer briefly.</em><br />
True.<br />
If each individual has their own hazard schedule proportional to baseline <span class="math inline">\(z\)</span>, there will be more variation in the distribution of deaths than if each person had the baseline case. The variation for homogeneous populations comes from to chance only, while the variation for heterogeneous populations comes from chance and group variation in risk. Therefore, the variance of the population distribution of deaths will always be larger than that of the baseline (unless the variance is 0).<br />
</li>
<li><p><em>Use the fraily simulator code to produce plots of the uniform, gamma, and U-shaped beta distribution. Describe in a sentence, each, how the population hazard behaves at older ages.</em><br />
For simplicity, we take the code and convert it into a function that can use frailty draws from different distributions. We also extend it to include life expectancy calculation.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">source</span>(<span class="st">&quot;functions/gomp_funs.R&quot;</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">frailty_sim &lt;-<span class="st"> </span><span class="cf">function</span>( N, z, base.a, base.b ){</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">  <span class="co">## (1) simulate ages at death from h0*z  using the gompertz as our baseline##</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">  <span class="co">## note: we call the continuous ages of death &quot;y&quot;</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6">  <span class="co">## but we&#39;ll make a table of deaths at age &quot;x&quot; and</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7">  <span class="co">## using life table notation call the count &quot;Dx&quot;</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8">  y &lt;-<span class="st"> </span><span class="kw">rgomp</span>(N,</a>
<a class="sourceLine" id="cb1-9" data-line-number="9">       <span class="dt">b =</span> base.b, <span class="co">## doesn&#39;t vary</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10">       <span class="dt">a =</span> base.a <span class="op">*</span><span class="st"> </span>z) <span class="co">## multiplicative fixed frailty</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1-12" data-line-number="12">  <span class="co">## (2) Lifetables: first define age at death as floor(y) and then</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13">  <span class="co">## make a table of deaths at each age (&quot;Dx&quot;)</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"></a>
<a class="sourceLine" id="cb1-15" data-line-number="15">  Dx &lt;-<span class="st"> </span><span class="kw">get.Dx</span>(y)</a>
<a class="sourceLine" id="cb1-16" data-line-number="16">  x &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">names</span>(Dx))  </a>
<a class="sourceLine" id="cb1-17" data-line-number="17">  lx &lt;-<span class="st"> </span><span class="kw">rev</span>(<span class="kw">cumsum</span>(<span class="kw">rev</span>(Dx))) <span class="co">## lx by reverse-survival</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18">  lxpn &lt;-<span class="st"> </span><span class="kw">c</span>(lx[<span class="op">-</span><span class="dv">1</span>], <span class="dv">0</span>) <span class="co">## Person-years as average of adjacent lx</span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19">  Lx &lt;-<span class="st"> </span>(lx <span class="op">+</span><span class="st"> </span>lxpn)<span class="op">/</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb1-20" data-line-number="20">  mx &lt;-<span class="st"> </span>Dx<span class="op">/</span>Lx <span class="co">## Hazards</span></a>
<a class="sourceLine" id="cb1-21" data-line-number="21">  Tx &lt;-<span class="st"> </span><span class="kw">rev</span>(<span class="kw">cumsum</span>(<span class="kw">rev</span>(Lx))) <span class="co">## Remaining person-years</span></a>
<a class="sourceLine" id="cb1-22" data-line-number="22">  ex &lt;-<span class="st"> </span>Tx<span class="op">/</span>lx <span class="co">## Life expectancy at age x</span></a>
<a class="sourceLine" id="cb1-23" data-line-number="23"></a>
<a class="sourceLine" id="cb1-24" data-line-number="24">  <span class="co">## Baseline lifetable</span></a>
<a class="sourceLine" id="cb1-25" data-line-number="25">  lx.base &lt;-<span class="st"> </span>N <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span><span class="st"> </span><span class="kw">pgomp</span>(x, <span class="dt">b =</span> base.b, <span class="dt">a =</span> base.a))</a>
<a class="sourceLine" id="cb1-26" data-line-number="26">  Dx.base &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="op">-</span><span class="kw">diff</span>(<span class="kw">c</span>(lx.base,<span class="dv">0</span>)))</a>
<a class="sourceLine" id="cb1-27" data-line-number="27">  mx.base &lt;-<span class="st"> </span>base.a <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(base.b <span class="op">*</span><span class="st"> </span>(x <span class="op">+</span><span class="st"> </span><span class="fl">.5</span>)) <span class="co">## x + .5</span></a>
<a class="sourceLine" id="cb1-28" data-line-number="28">  lxpn.base &lt;-<span class="st"> </span><span class="kw">c</span>(lx.base[<span class="op">-</span><span class="dv">1</span>], <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb1-29" data-line-number="29">  Lx.base &lt;-<span class="st"> </span>(lx.base <span class="op">+</span><span class="st"> </span>lxpn.base)<span class="op">/</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb1-30" data-line-number="30">  Tx.base &lt;-<span class="st"> </span><span class="kw">rev</span>(<span class="kw">cumsum</span>(<span class="kw">rev</span>(Lx.base)))</a>
<a class="sourceLine" id="cb1-31" data-line-number="31">  ex.base &lt;-<span class="st"> </span>Tx.base<span class="op">/</span>lx.base</a>
<a class="sourceLine" id="cb1-32" data-line-number="32"></a>
<a class="sourceLine" id="cb1-33" data-line-number="33"></a>
<a class="sourceLine" id="cb1-34" data-line-number="34">  <span class="co"># exported tables</span></a>
<a class="sourceLine" id="cb1-35" data-line-number="35">lifetables &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb1-36" data-line-number="36">lifetables<span class="op">$</span>sim &lt;-<span class="st"> </span>y</a>
<a class="sourceLine" id="cb1-37" data-line-number="37">lifetables<span class="op">$</span>z &lt;-<span class="st"> </span>z</a>
<a class="sourceLine" id="cb1-38" data-line-number="38">lifetables<span class="op">$</span>baseline &lt;-<span class="st"> </span><span class="kw">tibble</span>(Dx.base, lx.base,lxpn.base, Lx.base, mx.base, Tx.base, ex.base)</a>
<a class="sourceLine" id="cb1-39" data-line-number="39">lifetables<span class="op">$</span>frailty &lt;-<span class="st"> </span><span class="kw">tibble</span>(x,Dx, lx,lxpn, Lx, mx, Tx, ex)</a>
<a class="sourceLine" id="cb1-40" data-line-number="40">  <span class="kw">return</span>(lifetables)</a>
<a class="sourceLine" id="cb1-41" data-line-number="41"></a>
<a class="sourceLine" id="cb1-42" data-line-number="42">  }</a></code></pre></div>
<ol style="list-style-type: lower-alpha">
<li>Uniform distribution:<br />
We find that the uniform-distributed frailty begins to increase more slowly after age 60 compared to baseline.</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># Parameters</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">million =<span class="st"> </span><span class="dv">10</span><span class="op">^</span><span class="dv">6</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">N &lt;-<span class="st">  </span>million</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">base.a &lt;-<span class="st"> </span><span class="dv">10</span><span class="op">^-</span><span class="dv">4</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">base.b &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">9</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="kw">set.seed</span>(<span class="dv">1047</span>) <span class="co"># for reproducibility</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#Uniform distribution</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9">w &lt;-<span class="st"> </span><span class="fl">.3</span> <span class="co">## try smaller if you want</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10">z &lt;-<span class="st"> </span><span class="kw">runif</span>(N, <span class="dt">min =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>w , <span class="dt">max =</span> <span class="dv">1</span> <span class="op">+</span><span class="st"> </span>w)</a>
<a class="sourceLine" id="cb2-11" data-line-number="11">uniform_frailty &lt;-<span class="st"> </span><span class="kw">frailty_sim</span>(N, z, base.a, base.b)</a></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-6"></span>
<img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-6-1.png" alt="Uniform Distribution" width="100%" />
<p class="caption">
Figure 2.1: Uniform Distribution
</p>
</div>
<ol start="2" style="list-style-type: lower-alpha">
<li>Gamma frailty distribution:<br />
Gamma-distributed frailty begins to increase more slowly after age 60 compared to baseline.This is similar to the uniform frailty distribution.</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># Parameters</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">million =<span class="st"> </span><span class="dv">10</span><span class="op">^</span><span class="dv">6</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3">N &lt;-<span class="st">  </span>million</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">base.a &lt;-<span class="st"> </span><span class="dv">10</span><span class="op">^-</span><span class="dv">4</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">base.b &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">9</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="kw">set.seed</span>(<span class="dv">1047</span>) <span class="co"># for reproducibility</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">#Gamma distribution</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9">my.sd &lt;-<span class="st"> </span><span class="fl">.5</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"> sigma.sq &lt;-<span class="st"> </span>my.sd<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11">  z &lt;-<span class="st"> </span><span class="kw">rgamma</span>(N, <span class="dt">shape =</span> <span class="dv">1</span><span class="op">/</span>sigma.sq, <span class="dt">scale =</span> sigma.sq)</a>
<a class="sourceLine" id="cb3-12" data-line-number="12">gamma_frailty &lt;-<span class="st"> </span><span class="kw">frailty_sim</span>(N, z, base.a, base.b)</a></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-8"></span>
<img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-8-1.png" alt="Gamma Distribution" width="100%" />
<p class="caption">
Figure 2.2: Gamma Distribution
</p>
</div>
<ol start="3" style="list-style-type: lower-alpha">
<li>Beta frailty distribution:<br />
Beta-distributed frailty begins to increase more slowly after age 60 compared to baseline and eventually stops increasing at age 100.</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># Parameters</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">million =<span class="st"> </span><span class="dv">10</span><span class="op">^</span><span class="dv">6</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">N &lt;-<span class="st">  </span>million</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">base.a &lt;-<span class="st"> </span><span class="dv">10</span><span class="op">^-</span><span class="dv">4</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">base.b &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">9</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="kw">set.seed</span>(<span class="dv">1047</span>) <span class="co"># for reproducibility</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#Beta distribution</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9">z &lt;-<span class="st"> </span><span class="kw">rbeta</span>(N, <span class="dt">shape1 =</span> <span class="fl">.5</span>, <span class="dt">shape2 =</span> <span class="fl">.5</span>)</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">beta_frailty &lt;-<span class="st"> </span><span class="kw">frailty_sim</span>(N, z, base.a, base.b)</a></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-10"></span>
<img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-10-1.png" alt="Beta Distribution" width="100%" />
<p class="caption">
Figure 2.3: Beta Distribution
</p>
</div></li>
<li><em>Does the behavior of the uniform at older ages look like a population with two (proportional) sub-groups? What do you think is driving this?</em><br />
It doesn’t look like two proportional subgroups. It looks like the frailty is drawn from a single distribution.<br />
</li>
<li><em>Does the behavior of the beta at older ages look like the gamma at older ages? What do you think is driving this?</em><br />
The behavior is somewhat similar, as the hazards are increasing more slowly at older ages. However, the beta hazards stops increasing at a certain point. The uniform and the gamma are more similar. For the parameters we used, beta-distributed frailty generates many very-frail or very-robust individuals and fewer medium-frail individuals. Gamma-distributed frailty generates many medium-frail individuals but fewer very-frail or very-robust individuals.<br />
</li>
<li><em>At what age do population hazards start to diverge from the baseline in the the three models? Is it fair to say that half the cohort has to have died before unobserved heterogeneity plays a role?</em><br />
Generally around age 65, but if frailty is beta distributed (with our set of parameters) then we observe a divergence earlier. For the gamma and uniform frailty models roughly half the cohort has to die before unobserved heterogeneity plays a role, but for the beta model we observe divergence in the survival curve much earlier.<br />
</li>
<li><p><em>Extend the simulation code to include life expectancy at age x.</em><br />
Within the frailty function, we include the steps to calculate life expectancy. We also limit the ages up to 100 for each simulation, to avoid extreme and non-realistic results. This is particularly relevant for the beta frailty distribution which leads to ages above 110 to be sampled.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">Tx&lt;-<span class="st"> </span><span class="kw">rev</span>(<span class="kw">cumsum</span>(<span class="kw">rev</span>(Lx)))</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">ex &lt;-<span class="st"> </span>Tx<span class="op">/</span>lx</a></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-12"></span>
<img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-12-1.png" alt="Life expectancy comparison" width="65%" height="65%" />
<p class="caption">
Figure 2.4: Life expectancy comparison
</p>
</div></li>
<li><p><em>Extend the simulation code to include the average frailty of the surviving at age x, z(x). (Note: this requires some more difficulty programming, and I would recommend keeping your N fairly small.)</em></p></li>
</ol>
<div class="figure"><span id="fig:unnamed-chunk-14"></span>
<img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-14-1.png" alt="Uniform Hazards Average Frailty" width="65%" height="65%" />
<p class="caption">
Figure 2.5: Uniform Hazards Average Frailty
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-15"></span>
<img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-15-1.png" alt="Gamma Hazards Average Frailty" width="65%" height="65%" />
<p class="caption">
Figure 2.6: Gamma Hazards Average Frailty
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-16"></span>
<img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-16-1.png" alt="Beta Hazards Average Frailty" width="65%" height="65%" />
<p class="caption">
Figure 2.7: Beta Hazards Average Frailty
</p>
</div>
<ol start="8" style="list-style-type: decimal">
<li><em>Extend the simulation code to histograms of frailty of survivors at different ages. Does the uniform stay uniform? How about the other distributions?</em><br />
The uniform does not remain uniform. This matches our intuition that people with higher frailty will die off first. This leaves an exponentially decreasing distribution of frailty for survivors age 75+. The gamma remains a gamma but the parameters change. The beta, similar to the uniform, does not remain beta. There is an exponentially decreasing distribution of frailty for survivors age 75+.
<div class="figure"><span id="fig:unnamed-chunk-17"></span>
<img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-17-1.png" alt="Uniform Hazards Frailty" width="65%" height="65%" />
<p class="caption">
Figure 2.8: Uniform Hazards Frailty
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-18"></span>
<img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-18-1.png" alt="Gamma Hazards Frailty" width="65%" height="65%" />
<p class="caption">
Figure 2.9: Gamma Hazards Frailty
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-19"></span>
<img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-19-1.png" alt="Beta Hazards Frailty" width="65%" height="65%" />
<p class="caption">
Figure 2.10: Beta Hazards Frailty
</p>
</div></li>
<li><em>Use the method of completing the gamma to get the mean of the gamma distribution.</em><br />
<span class="math display">\[\begin{aligned}
\mu 
&amp; = \int_0^{\infty} \frac{1}{\Gamma(k) \lambda^k} z^{k - 1} e^{-\frac{z}{\lambda}} \\
&amp; = \frac{\Gamma(k+1) \lambda^{k+1}}{\Gamma(k+1) \lambda^{k+1}} \cdot \int_0^{\infty} \frac{1}{\Gamma(k) \lambda^k} z^{k - 1} e^{-\frac{z}{\lambda}} \\
&amp; = \frac{\Gamma(k+1) \lambda^{k+1}}{\Gamma(k) \lambda^{k}} \cdot \int_0^{\infty} \frac{1}{\Gamma(k+1) \lambda^{k+1}} z^{k - 1} e^{-\frac{z}{\lambda}} \\ 
&amp; = k \lambda \cdot 1 \\
&amp; = k \lambda
\end{aligned}\]</span></li>
<li><em>Derive V&amp;M equation 13, extending Keyfitz’s result. Did your derivation require you to assume proportional hazards; if so, where?</em><br />
</li>
<li><em>Derive V&amp;M equation 20, extending Keyfitz’s result to proportional changes in the population hazard. Did your derivation require you to assume proportional hazards; if so, where?</em><br />
</li>
<li><em>Describe a strategy for simulating cross-overs in the aggregate hazards of two groups, which have baseline hazards that don’t cross. If you want, write code and produce a plot.</em></li>
</ol>

</div>
</div>
<div id="problem-set-3" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Problem set 3</h1>
<div id="questions-2" class="section level2">
<h2><span class="header-section-number">3.1</span> Questions</h2>
<ol style="list-style-type: decimal">
<li>Under gamma frailty, we obtained an explicit expression for average frailty by age for any baseline hazard schedule. <span class="math display">\[ \bar{z}=\frac{1}{1+\sigma^2 H_0(x)}\]</span> Assume baseline mortality is Gompertz (say with a = <span class="math inline">\(10^{-4}\)</span> and b = 1/12). Try a couple of different values of <span class="math inline">\(\sigma^2\)</span> (but make sure one of these values is 1/7 for comparability with the next problem). Describe what happens to average frailty at older ages. Does it decrease exponentially? If so, is there an age at which the rate of decrease equals (or at least comes very close to) the exponential rate of increase in baseline hazards b? Does this age depend on <span class="math inline">\(\sigma^2\)</span>?<br />
</li>
<li>Obtain from the Human Mortality Database a schedule of single-year-of-age, cohort mortality rates for females born in 1880 in Italy. Use the “inversion formula” for the gamma distribution to obtain the baseline hazards implied by <span class="math inline">\(\sigma^2= 1/7\)</span>. Plot the observed and implied baseline schedule. Plot the average frailty by age. Do your results resemble or differ from the Gompertz case above ?</li>
<li>Derive V&amp;M ’s result (5E):<span class="math display">\[\overline{R}(x) \equiv \frac{\bar{\mu}_2(x)}{\bar{\mu}_1(x)} = \frac{R + R \sigma_1^2 H_1(x)}{1 + R \sigma_2^2 H_1(x)} \]</span><br />
</li>
<li>Use mathematics to say what the determinants of the age of crossover are in terms of the respective frailty variances, R, and a baseline Gompertz schedule.</li>
<li>Simulate this cross over with two proportional Gompertz schedules, with different frailty variances. Can you get a cross-over? If so, does it occur when cumulative hazard satisfy the condition (in small font) at the end of 5E?<br />
</li>
<li>Use simulation to say what the determinants of the age of crossover are in terms of the respective frailty variances, R, and the baseline Gompertz schedule.<br />
</li>
<li>Get two Italian cohorts 20 years apart and calculate the rate of mortality improvement by age <span class="math inline">\(\rho(x)\)</span> that you observe and that which you would have observed had there been no frailty. For frailty, assume gamma-distributed with <span class="math inline">\(\sigma^2 = 1/5\)</span>.<br />
</li>
<li>Extend the CenSoc demonstration of changing characteristics with age in at least one of the following ways
<ol style="list-style-type: lower-alpha">
<li>Use years of education instead of wage income.</li>
<li>Use both years of education and wage income.</li>
<li>Analyze Blacks and Whites separately using wage income? Is the variance of “observed heterogeneity” (<span class="math inline">\(\hat{z}_{obs}\)</span>) larger for one group. Discuss briefly.</li>
</ol></li>
</ol>
</div>
<div id="solutions-2" class="section level2">
<h2><span class="header-section-number">3.2</span> Solutions</h2>
<ol style="list-style-type: decimal">
<li><em>Under gamma frailty, we obtained an explicit expression for average frailty by age for any baseline hazard schedule. <span class="math display">\[ \bar{z}=\frac{1}{1+\sigma^2 H_0(x)}\]</span> Assume baseline mortality is Gompertz (say with a = <span class="math inline">\(10^{-4}\)</span> and b = 1/12). Try a couple of different values of <span class="math inline">\(\sigma^2\)</span> (but make sure one of these values is 1/7 for comparability with the next problem). Describe what happens to average frailty at older ages. Does it decrease exponentially? If so, is there an age at which the rate of decrease equals (or at least comes very close to) the exponential rate of increase in baseline hazards <span class="math inline">\(b\)</span>? Does this age depend on <span class="math inline">\(\sigma^2\)</span>?</em><br />
Let <span class="math inline">\(H_0\)</span> be a gompertz curve with parameters a = <span class="math inline">\(10^{-4}\)</span> and b = 1/12. The average frailty over age depends on the level of <span class="math inline">\(\sigma^2\)</span> as seen by the left handside graph. As <span class="math inline">\(\sigma^2\)</span> increases, average fraily decreases at an exponential rate at earlier ages. That is, when <span class="math inline">\(\sigma^2\)</span> is very large (ie, 50) the exponential decrease begins almost instantly. However, with a very small <span class="math inline">\(\sigma^2\)</span> of 0.01 the average frailty is almost constant except at older ages. Therefore <span class="math inline">\(\sigma^2\)</span> determines when average frailty starts to decrease.<br />
The graph on the right shows the derivative over ages of each of the average frailty curves as well as the <span class="math inline">\(b\)</span> parameter of the baseline Gompertz mortality (in blue). Regardless of the the value of <span class="math inline">\(\sigma^2\)</span>, none of the derivatives are close enough to equal the <span class="math inline">\(b\)</span> parameter.Analytically, the derivative of average frailty is always going to be negative and very small. <span class="math display">\[\frac{d}{dx}\bar{z}= -\sigma^2ae^{bx}\bar{z}(x)^2\]</span>.<br />

<div class="figure"><span id="fig:unnamed-chunk-21"></span>
<img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-21-1.png" alt="Average frailty by age" width="100%" height="65%" />
<p class="caption">
Figure 3.1: Average frailty by age
</p>
</div></li>
<li><em>Obtain from the Human Mortality Database a schedule of single-year-of-age, cohort mortality rates for females born in 1880 in Italy. Use the “inversion formula” for the gamma distribution to obtain the baseline hazards implied by <span class="math inline">\(\sigma^2= 1/7\)</span>. Plot the observed and implied baseline schedule. Plot the average frailty by age. Do your results resemble or differ from the Gompertz case above ?</em>
In order to get the baseline hazards implied by <span class="math inline">\(\sigma^2\)</span> = 1/7, we can use the inversion formula <span class="math display">\[\mu_0 (x) = \bar{\mu}(x)e^{\sigma^2\bar{H}(x)}\]</span><br />
Taking logs, this gives us <span class="math display">\[log(\mu_0 (x)) = log(\bar{\mu}(x))+{\sigma^2log(\bar{H}(x))}\]</span><br />
<span class="math inline">\(H(x)\)</span> is equal to the summation of <span class="math inline">\(\mu(x)\)</span> in continuous time, so we can take the cumulative sum of these mortality rates to get the cumulative hazards. We can then use this to calculate the baseline hazards schedule.<br />

<div class="figure"><span id="fig:unnamed-chunk-22"></span>
<img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-22-1.png" alt="Observed and implied hazards" width="100%" height="65%" />
<p class="caption">
Figure 3.2: Observed and implied hazards
</p>
</div>
Now let’s plot average frailty by age. While the shape of the mean frailty graph is the same in both cases, average frailty seems to decline more rapidly here than in the Gompertz case (this is driven by early ages.)<br />

<div class="figure"><span id="fig:unnamed-chunk-23"></span>
<img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-23-1.png" alt="Observed and implied hazards" width="100%" height="65%" />
<p class="caption">
Figure 3.3: Observed and implied hazards
</p>
</div></li>
<li><em>Derive V&amp;M ’s result (5E)</em>
Since <span class="math inline">\(\mu_2(x) = R\mu_1(x)\)</span> and frailty is distributed gamma with variances <span class="math inline">\(\sigma_1^2\)</span> and <span class="math inline">\(\sigma_2^2\)</span>, respectively, we can rewrite <span class="math display">\[\bar{R}(x) = \frac{\bar{\mu_2}(x)}{\bar{\mu_1(x)}}\]</span> as<br />
<span class="math display">\[\begin{aligned}
\bar{R}(x) &amp; = {\mu_2(x) \over 1+\sigma^2_2H_2(x)} \times{1+H_1(x)\sigma^2_1 \over \mu_1(x)} \\
 &amp; = { \bar{\mu}_2(x) \over \bar{\mu}_1(x) }\times { 1+H_1(x)\sigma^2_1 \over 1+H_2(x)\sigma^2_2 }
\end{aligned}\]</span>
Since <span class="math inline">\(H_2 = R*H_1\)</span>,
<span class="math display">\[\begin{aligned}
 &amp; = {R} \times { 1+\sigma^2_1 H_1(x) \over 1+R\sigma^2_2 H_1(x) }\\
 &amp; = { R+R\sigma^2_1 H_1(x) \over 1+R\sigma^2_2 H_1(x) }
 \end{aligned}\]</span></li>
<li><em>Use mathematics to say what the determinants of the age of crossover are in terms of the respective frailty variances, R, and a baseline Gompertz schedule.</em><br />
The age crossover occurs at <span class="math inline">\(\bar{u_1} = \bar{u_2}\)</span>, which occurs at <span class="math inline">\(\bar{R} = 1\)</span>.
Rearranging 5E after equating it to 1 gives us
<span class="math display">\[1+R\sigma_2^2(H_1(x_c)) = R+R\sigma_1^2(H_1(x_c))\]</span>
<span class="math display">\[H_1(x_c)(R\sigma_1^2 - R\sigma_2^2) = 1-R\]</span>
<span class="math display">\[H_1(x_c) = { R -1 \over R(\sigma_2^2 - \sigma_1^2)}\]</span>
Assuming a baseline hazard schedule <span class="math inline">\(H_1(x)\)</span> that is Gompertzian, we can solve to get the age of crossover <span class="math inline">\(x_c\)</span>.
<span class="math display">\[ \begin{aligned} 
 {a \over b}(e^{bx_c} -1) &amp; = { R -1 \over R(\sigma_2^2 - \sigma_1^2)} \\ 
 x_c &amp; = {1 \over b} \log \bigg({ {(b/a)(R-1)}\over R(\sigma^2_2-\sigma^2_1)} +1\bigg)
 \end{aligned}\]</span></li>
<li><p><em>Simulate this cross over with two proportional Gompertz schedules, with different frailty variances. Can you get a cross-over? If so, does it occur when cumulative hazard satisfy the condition (in small font) at the end of 5E?</em><br />
We borrow the frailty simulation function from problem set 2 and use it to create two schedules with Gamma frailty distributions (with different variances) and where the scales of the gompertz curves are proportional.</p>
Now we can graph this to observe the crossover. In Problem 4, we calculate an age where this crossover would occur based on 5E, and here, graphing that line in grey, we see that the crossover occurs at exactly that point.<br />

<div class="figure"><span id="fig:unnamed-chunk-25"></span>
<img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-25-1.png" alt="Mortality crossover" width="100%" height="65%" />
<p class="caption">
Figure 3.4: Mortality crossover
</p>
</div></li>
<li><p><em>Use simulation to say what the determinants of the age of crossover are in terms of the respective frailty variances, R, and the baseline Gompertz schedule.</em><br />
If we alter any of the parameters here, it would change the age of crossover in accordance with that observed in Problem 4. We can simulate this by writing the previous code as a function and running it with different parameters.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">get.crossover.plot &lt;-<span class="st"> </span><span class="cf">function</span>( N, sigmasq.<span class="fl">1.</span>fun, sigmasq.<span class="fl">2.</span>fun, beta.fun, alpha.fun, R.fun) {</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#Now let&#39;s generate the zs for this using the rgamma function.</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4">z1.fun &lt;-<span class="st"> </span><span class="kw">rgamma</span>(N, <span class="dt">shape =</span> <span class="dv">1</span><span class="op">/</span>sigmasq<span class="fl">.1</span>, <span class="dt">scale =</span> sigmasq<span class="fl">.1</span>)</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">z2.fun &lt;-<span class="st"> </span><span class="kw">rgamma</span>(N, <span class="dt">shape =</span> <span class="dv">1</span><span class="op">/</span>sigmasq<span class="fl">.2</span>, <span class="dt">scale =</span> sigmasq<span class="fl">.2</span>)</a>
<a class="sourceLine" id="cb6-6" data-line-number="6"></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#Since these are proportional Gompertzian schedules, they will have the same b but different alphas, scaled by R</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#We can use the frailty simulation function from now onwards</span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"></a>
<a class="sourceLine" id="cb6-10" data-line-number="10">schedule1 &lt;-<span class="st"> </span><span class="kw">frailty_sim</span>(N, z1.fun, <span class="dt">base.a =</span> alpha.fun, <span class="dt">base.b =</span>beta.fun)</a>
<a class="sourceLine" id="cb6-11" data-line-number="11">schedule2 &lt;-<span class="st"> </span><span class="kw">frailty_sim</span>(N, z2.fun, <span class="dt">base.a =</span> R<span class="op">*</span>alpha.fun, <span class="dt">base.b =</span>beta.fun)</a>
<a class="sourceLine" id="cb6-12" data-line-number="12"></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="co">#Crossover plots</span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="kw">plot</span>(schedule1<span class="op">$</span>frailty<span class="op">$</span>x, <span class="kw">log</span>(schedule1<span class="op">$</span>frailty<span class="op">$</span>mx), <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;Age&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;log hx&quot;</span>)</a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="kw">lines</span>(schedule2<span class="op">$</span>frailty<span class="op">$</span>x, <span class="kw">log</span>(schedule2<span class="op">$</span>frailty<span class="op">$</span>mx), <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb6-16" data-line-number="16"><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Variance&quot;</span>, <span class="dt">legend =</span> <span class="kw">c</span>(sigmasq.<span class="fl">1.</span>fun, sigmasq.<span class="fl">2.</span>fun ), <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>),</a>
<a class="sourceLine" id="cb6-17" data-line-number="17">   <span class="dt">lwd =</span> <span class="dv">2</span>,<span class="dt">lty =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb6-18" data-line-number="18"><span class="kw">mtext</span>(<span class="kw">paste0</span>(<span class="st">&quot;R= &quot;</span>, R.fun,<span class="st">&quot; Base a = &quot;</span>, alpha.fun, <span class="st">&quot; Base b = &quot;</span>, <span class="kw">round</span>(beta.fun,<span class="dv">2</span>) ), <span class="dt">side=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb6-19" data-line-number="19">}</a></code></pre></div>
Now let’s run this for different values of alpha, beta, R, and the two variances. In the first set of graphs, changing the two variances to compare when they are very different and when they are very similar. Age of crossover does not seem to change very much.<br />

<div class="figure"><span id="fig:unnamed-chunk-27"></span>
<img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-27-1.png" alt="Crossover: changing variances" width="100%" height="65%" />
<p class="caption">
Figure 3.5: Crossover: changing variances
</p>
</div>
Then, when changing alpha so that we can compare a very small alpha with a large one, a crossover occurs earlier with a larger value.
<div class="figure"><span id="fig:unnamed-chunk-28"></span>
<img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-28-1.png" alt="Crossover: changing Gompertz $a$ parameter" width="100%" height="65%" />
<p class="caption">
Figure 3.6: Crossover: changing Gompertz <span class="math inline">\(a\)</span> parameter
</p>
</div>
By changing beta to compare a very small beta and a large one, we get a crossover very early with a large beta.<br />

<div class="figure"><span id="fig:unnamed-chunk-29"></span>
<img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-29-1.png" alt="Crossover: changing Gompertz $b$ parameter" width="100%" height="65%" />
<p class="caption">
Figure 3.7: Crossover: changing Gompertz <span class="math inline">\(b\)</span> parameter
</p>
</div>
Finally, if we compare a large and small r, there does not seem to be a difference in the crossover ages.<br />

<div class="figure"><span id="fig:unnamed-chunk-30"></span>
<img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-30-1.png" alt="Crossover: changing $R$" width="100%" height="65%" />
<p class="caption">
Figure 3.8: Crossover: changing <span class="math inline">\(R\)</span>
</p>
</div></li>
<li><p><em>Get two Italian cohorts 20 years apart and calculate the rate of mortality improvement by age <span class="math inline">\(\rho(x)\)</span> that you observe and that which you would have observed had there been no frailty. For frailty, assume gamma-distributed with <span class="math inline">\(\sigma^2 = 1/5\)</span>.</em><br />
We obtain the Italian cohort female lifetable (1x1) from the Human Mortality Database (HMD).</p>
The observed rate of mortality improvement can be calculated using <span class="math display">\[ \bar{\rho}(x,t) = - {1 \over t} \log {m_{t2}(x) \over m_{t1}(x) }\]</span> and the version with frailty can be calculated using: <span class="math display">\[ \rho(x,t) = \bar{\rho}(x,t) + \sigma^2\ {d \over dt}\bar{S}_c (x,t) \]</span> Now we can calculate the rates of improvement in mortality and compare them. When we assume frailty, we get a higher rate of improvement at the older ages than in the observed case.<br />

<div class="figure"><span id="fig:unnamed-chunk-32"></span>
<img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-32-1.png" alt="Mortality improvement" width="100%" height="65%" />
<p class="caption">
Figure 3.9: Mortality improvement
</p>
</div></li>
<li><em>Extend the CenSoc demonstration of changing characteristics with age in at least one of the following ways</em>
<ol style="list-style-type: lower-alpha">
<li><em>Use years of education instead of wage income.</em><br />
</li>
<li><em>Use both years of education and wage income.</em><br />
</li>
<li><p><em>Analyze Blacks and Whites separately using wage income? Is the variance of “observed heterogeneity” (<span class="math inline">\(\hat{z}_{obs}\)</span>) larger for one group. Discuss briefly.</em></p></li>
<li><p>Let’s see how this changes for education.</p></li>
</ol></li>
</ol>
<pre><code>## NULL</code></pre>
<pre><code>## NULL</code></pre>
<p><img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-34-1.png" width="672" />
b. The easiest way to compare both income and education is to compare income (on the y-axis) while letting education vary. For simplicity we took 4 education bins: 0-5 years, 5-10 years, 10-15 years and more than 15 years: as well as their standardized analoges. The intensity of colors increases with the number of years of education.
<img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-35-1.png" width="672" />
c. We’ll run the wage income comparison for Blacks and Whites separately.</p>
<pre><code>Now let&#39;s graph these two. We can see a decline in log wages with age for Blacks that we do not observe for Whites, for whom this tends to increase by age. This suggests that we may observe greater variance in heterogeneity for blacks than for Whites.   </code></pre>
<p><img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-37-1.png" width="672" /><img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-37-2.png" width="672" /></p>

</div>
</div>
<div id="problem-set-6" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Problem set 6</h1>
<div id="questions-3" class="section level2">
<h2><span class="header-section-number">4.1</span> Questions</h2>
<ol style="list-style-type: decimal">
<li>Using the tempo_simu.R file,
<ol style="list-style-type: lower-alpha">
<li>Try with N of 4 million – does it still work? What happens?</li>
<li>Try with a shift function that goes up and down. Are the adjusted counts ever LESS than the observed counts? If so, when?<br />
</li>
<li>If the cumulative shift was Rt = a + 0.1*t, what would be a formula for tempo-adjusted counts of births? Sketch the 4 panels without the computer and then check to see if you’re right.</li>
</ol></li>
<li>Calculate the age profile of fertility change predicted by the BongaartsFeeney model by taking time derivatives of the log schedules. You will end up with three terms. Describe each of these in words.<br />
</li>
<li>Use simulation based on tempo simu.R to check your answer.<br />
</li>
<li>Is there a diagnostic plot that you could do to compare observed agespecific changes to those predicted by the BF model? Hint: use normalized schedules that sum to 1.0<br />
</li>
<li>Use this diagnostic plot to all-order fertility change during the Great Recession.<br />
</li>
<li>Use this diagnostic plot to 1st, 2nd, and 3rd births.<br />
</li>
<li>Fit the two-part normal mixture model to fertility from another country based on what looks interesting in the Burkimsher paper. (E.g., Canada, Portugal, or the Netherlands). I recommend doing this for 1 year, but once you get your code running, you could iterate over years. Use graphs to discuss the goodness of fit. And if you do more than 1 year, discuss whether the time trends in the parameters make substantive sense)</li>
</ol>
</div>
<div id="solutions-3" class="section level2">
<h2><span class="header-section-number">4.2</span> Solutions</h2>
<ol style="list-style-type: decimal">
<li>Using the tempo_simu.R file,
<ol style="list-style-type: lower-alpha">
<li>Try with N of 4 million – does it still work? What happens?
This simulation will first sample from a normal distribution draws of ages that represent the ages of women when giving birth for the first time. It also creates as shift function <span class="math inline">\(R(t)\)</span> which affects all women of a given year.
<img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-38-1.png" width="672" /><img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-38-2.png" width="672" />
Yes, it still works. In fact, we see that the adjusted births are very close to the observed births when using this number of simulations. (I continue to use an N of 4 million for the rest of this problem).<br />
</li>
<li>Try with a shift function that goes up and down. Are the adjusted counts ever LESS than the observed counts? If so, when?<br />
<img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-39-1.png" width="672" /><img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-39-2.png" width="672" />
The adjusted counts are not always less than the observed. Naturally, this only happens when we have spikes on the observed counts that become smoother after the adjusting of the birth counts.<br />
</li>
<li>If the cumulative shift was Rt = a + 0.1*t, what would be a formula for tempo-adjusted counts of births? Sketch the 4 panels without the computer and then check to see if you’re right.<br />
Let <span class="math inline">\(a = -199\)</span>, so we get a shift of 0 to about 3 years depending on the time period:<br />
<img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-40-1.png" width="672" /><img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-40-2.png" width="672" /></li>
</ol></li>
<li>Calculate the age profile of fertility change predicted by the BongaartsFeeney model by taking time derivatives of the log schedules. You will end up with three terms. Describe each of these in words.<br />
<span class="math display">\[\begin{aligned}
 f(a,t)&amp;=f_0(a-R(t))[1-R&#39;(t)]q(t)\\
 log(f(a,t))&amp;=log(f_0(a-R(t))) + log(1-R&#39;(t)) + log(q(t))\\
 \frac{\partial log(f(a,t))}{\partial t}&amp;=\frac{\partial log(f_0(a-R(t)))}{\partial t} + \frac{\partial
 log(1-R&#39;(t))}{\partial t} + \frac{\partial log(q(t))}{\partial t}\\
 \frac{\partial log(f(a,t))}{\partial t}&amp;=-R&#39;(t)\frac{f_0&#39;(a-R(t))}{f_0(a-R(t))} -\frac{R&#39;&#39;(t)}{1-R&#39;(t)} + \frac{q&#39;(t)}{q(t)}
 \end{aligned}\]</span>
The first term represents the proportional change in the fertility of the equivalent pre-postponement cohort. In particular, it is divided into (how far someone shifts ‘over’ relative to ages on the baseline fertility schedule) and an <span class="math inline">\(R&#39;(t)\)</span> term (how much one shifts ‘up’). The second term represents the proportional change in the rate of change in years of postponement; it is a tempo-effect. The third term represents the proportional change in quantum.</li>
<li><p>Use simulation based on tempo simu.R to check your answer.</p>
The <code>tempo_simu.R</code> function computes <span class="math inline">\(R(t)\)</span> but we need to obtain the remaining components of the answer from the previous excercise. For simplicity, let’s assume that there are no tempo effects (<span class="math inline">\(q(t)=0\)</span>) and that <span class="math inline">\(a=25\)</span>, that is, our baseline schedule is that of women aged 25.
<ol style="list-style-type: lower-alpha">
<li><span class="math inline">\(R(t)\)</span> components:
Let’s briefly look at <span class="math inline">\(R(t)\)</span>, <span class="math inline">\(R&#39;(t)\)</span>, and <span class="math inline">\(R&#39;&#39;(t)\)</span>. In <code>tempo_simu.R</code> <span class="math inline">\(R(t)\)</span> refers to the cumulative shift object (<code>shift.t</code> ). We can obtain the derivatives by taking the centered difference of this object.</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">shift.t.prime &lt;-<span class="st"> </span><span class="kw">center.diff</span>(shift.t)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">shift.t.prime<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">center.diff</span>(shift.t.prime)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="kw">plot</span>(<span class="dv">1991</span><span class="op">:</span><span class="dv">2020</span>, shift.t, <span class="dt">main =</span> <span class="st">&#39;R(t)&#39;</span>, <span class="dt">xlab =</span> <span class="st">&#39;&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;&#39;</span>)</a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="kw">plot</span>(<span class="dv">1991</span><span class="op">:</span><span class="dv">2020</span>, shift.t.prime, <span class="dt">main =</span> <span class="st">&#39;R</span><span class="ch">\&#39;</span><span class="st">(t)&#39;</span>, <span class="dt">xlab =</span> <span class="st">&#39;&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;&#39;</span>)</a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="kw">plot</span>(<span class="dv">1991</span><span class="op">:</span><span class="dv">2020</span>, shift.t.prime<span class="fl">.2</span>, <span class="dt">main =</span> <span class="st">&#39;R</span><span class="ch">\&#39;\&#39;</span><span class="st">(t)&#39;</span>, <span class="dt">xlab =</span> <span class="st">&#39;&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;&#39;</span>)</a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="kw">plot</span>(<span class="dv">1991</span><span class="op">:</span><span class="dv">2020</span>,<span class="op">-</span>shift.t.prime<span class="fl">.2</span><span class="op">/</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>shift.t.prime), <span class="dt">main =</span> <span class="st">&#39;-R</span><span class="ch">\&#39;\&#39;</span><span class="st">(t) / (1- R</span><span class="ch">\&#39;</span><span class="st">(t))&#39;</span>, <span class="dt">xlab =</span> <span class="st">&#39;year&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;&#39;</span>)</a></code></pre></div>
<img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-42-1.png" width="768" />
<ol start="2" style="list-style-type: lower-alpha">
<li><span class="math inline">\(f_0(a-R(t))\)</span> function:
In the Bongaarts and Feeney model, the baseline schedule of women of age <span class="math inline">\(a\)</span> at time <span class="math inline">\(t\)</span> is <span class="math inline">\(f_0(a-R(t))\)</span>. That is, it is the fertility schedule that is observed because of the shift. From the simulation, we obtain a table of births at each age and the age-specific fertility rates. Then, we can look at the original and the observed ASFRs. The original ASFR is that from the simulation, which we would not observe. Rather we would only the see the ASFR from births that were postponed by year-specific shifts.</li>
</ol>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co"># floor everything</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2">dt_floored &lt;-<span class="st"> </span>dt <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="kw">transmute</span>(<span class="st">&#39;x&#39;</span> =<span class="st"> </span><span class="kw">floor</span>(x), <span class="st">&#39;t&#39;</span> =<span class="st"> </span><span class="kw">floor</span>(t), </a>
<a class="sourceLine" id="cb11-4" data-line-number="4">          <span class="st">&#39;t.obs&#39;</span> =<span class="st"> </span><span class="kw">floor</span>(t.obs), <span class="st">&#39;x.obs&#39;</span> =<span class="st"> </span><span class="kw">floor</span>(x.obs)) <span class="co"># the .obs values are the ones that go into the baseline function. </span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="co"># Births to women born at each age. </span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7">original_sched &lt;-<span class="st"> </span><span class="kw">table</span>(dt_floored<span class="op">$</span>x, dt_floored<span class="op">$</span>t)</a>
<a class="sourceLine" id="cb11-8" data-line-number="8">observed_sched &lt;-<span class="st"> </span><span class="kw">table</span>(dt_floored<span class="op">$</span>x.obs, dt_floored<span class="op">$</span>t.obs)</a>
<a class="sourceLine" id="cb11-9" data-line-number="9"></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="co"># ASFR (The denominator is 100 person years lived, or 100 women at each age)</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11">asfr_original&lt;-<span class="st"> </span>original_sched<span class="op">/</span>(<span class="dv">100</span><span class="op">*</span>thousand) <span class="co">#f(a,t)</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12">asfr_observed &lt;-<span class="st"> </span>observed_sched<span class="op">/</span>(<span class="dv">100</span><span class="op">*</span>thousand) <span class="co">#f_0(a,t)</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="co">#Graph of ASFRs for observed and original births. The lines get lighter with each year. </span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="kw">matplot</span>(<span class="kw">rownames</span>(asfr_observed), asfr_observed, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">col=</span><span class="kw">grey</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length =</span> <span class="dv">40</span>)), </a>
<a class="sourceLine" id="cb11-17" data-line-number="17">    <span class="dt">xlab =</span> <span class="st">&#39;Age&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;ASFR&#39;</span>, <span class="dt">main =</span> <span class="st">&#39;Observed ASFR&#39;</span>)</a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="kw">abline</span>(<span class="dt">v=</span> <span class="dv">25</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&#39;black&#39;</span>)</a>
<a class="sourceLine" id="cb11-19" data-line-number="19"></a>
<a class="sourceLine" id="cb11-20" data-line-number="20"><span class="kw">matplot</span>(<span class="kw">rownames</span>(asfr_original), asfr_original, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">col=</span><span class="kw">grey</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length =</span> <span class="dv">40</span>)), </a>
<a class="sourceLine" id="cb11-21" data-line-number="21">    <span class="dt">xlab =</span> <span class="st">&#39;Age&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;ASFR&#39;</span>, <span class="dt">main =</span> <span class="st">&#39;Original ASFR&#39;</span>)</a>
<a class="sourceLine" id="cb11-22" data-line-number="22"><span class="kw">abline</span>(<span class="dt">v=</span> <span class="dv">25</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&#39;black&#39;</span>)</a></code></pre></div>
<img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-43-1.png" width="672" />
The component that we are interersted in is the first derivative of the baseline schedule (<span class="math inline">\(f_0(a-R(t))\)</span>).
<img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-44-1.png" width="672" />
<ol start="3" style="list-style-type: lower-alpha">
<li>Comparison of terms from original and observed data:
We can merge all the terms of the formula from the previous question and compare it to the derivative of the log version of the observed fertility schedules.
<img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-45-1.png" width="672" /><img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-45-2.png" width="672" /></li>
</ol>
<pre><code>##             5             6             7             8             9            10            11            12 
##           NaN           NaN           NaN           NaN           Inf           NaN  0.0279104400  0.0284926376 
##            13            14            15            16            17            18            19            20 
##  0.0264610984  0.0237212086  0.0217063493  0.0201999478  0.0180307054  0.0163718360  0.0143367711  0.0126676950 
##            21            22            23            24            25            26            27            28 
##  0.0108740251  0.0089406636  0.0070038016  0.0051380233  0.0032746533  0.0013796601 -0.0004524888 -0.0022009709 
##            29            30            31            32            33            34            35            36 
## -0.0041665665 -0.0059568771 -0.0079508464 -0.0098116081 -0.0116493883 -0.0134483969 -0.0152374780 -0.0174666475 
##            37            38            39            40            41            42            43            44 
## -0.0187958955 -0.0213274275 -0.0225088932 -0.0246023349 -0.0284561023 -0.0218511609           NaN           NaN 
##            45            46            47            48 
##           NaN           NaN           NaN           NaN</code></pre>
<pre><code>##           5           6           7           8           9          10          11          12          13 
##         NaN         NaN         NaN        -Inf -0.04661512 -0.03769700 -0.02995997 -0.06192639 -0.05078215 
##          14          15          16          17          18          19          20          21          22 
## -0.04858363 -0.05152016 -0.05218837 -0.05159206 -0.05148395 -0.05160988 -0.05209997 -0.05204756 -0.05258484 
##          23          24          25          26          27          28          29          30          31 
## -0.05193104 -0.05309911 -0.05345465 -0.05218494 -0.05232512 -0.05222811 -0.05151393 -0.05223201 -0.05259580 
##          32          33          34          35          36          37          38          39          40 
## -0.05334486 -0.05261664 -0.05131790 -0.04743019 -0.05145224 -0.06105139 -0.06151550 -0.04560559        -Inf 
##          41          42          43          44          45 
##        -Inf         NaN         NaN         NaN         NaN</code></pre>
<p><img src="Random_Demography_Problems_files/figure-html/unnamed-chunk-45-3.png" width="672" /></p></li>
</ol>

</div>
</div>
<div id="problem-set-8" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Problem set 8</h1>
<div id="problems" class="section level2">
<h2><span class="header-section-number">5.1</span> Problems</h2>
</div>
<div id="solutions-4" class="section level2">
<h2><span class="header-section-number">5.2</span> Solutions</h2>
<p>For the following problems, let <span class="math inline">\(p_0 = 0.3\)</span>, <span class="math inline">\(p_1=0.3\)</span>, <span class="math inline">\(p_2=0.4\)</span>. Use the function <span class="math inline">\(h(z) = p_0 + p_1 z + p_2 z^2\)</span>. This gives <span class="math inline">\(m= 0.3(0) + 0.3(1) + 0.4(2) = 1.1\)</span>, which is supercritical.<br />
1. Multiply out <span class="math inline">\(h(z)^3\)</span> algebraically and explain how the coefficient on <span class="math inline">\(z^4\)</span> consists of all of the possible ways for 3 fathers to produce a total of 4 sons
Finding <span class="math inline">\(h(z)^2\)</span>:
<span class="math display">\[\begin{aligned} 
    h(z)^2 &amp;= (p_0 + p_1 z + p_2 z^2)\times(p_0 + p_1 z + p_2 z^2) \\
    &amp;= p_0^2+2p_0p_1z+(2p_0p_2+p_1^2)z^2 + 2p_1p_2z^3 + p_2^2z^4
    \end{aligned}\]</span>
Multiplying out again:
<span class="math display">\[\begin{aligned}
    h(z)^3 &amp;= h(z)^2 h(z) \\
    &amp;= [p_0^2+2p_0p_1z+(2p_0p_2+p_1^2)z^2 + 2p_1p_2z^3 + p_2^2z^4]\times(p_0 + p_1 z + p_2 z^2) \\
    &amp;= p_0^3 + (3p_0^2p_1)z + (3p_0^2p_2 + 3p_0p_1^2)z^2 +(6p_0p_1p_2+p_1^3)z^3 + \\
    &amp; (3p_0p_2^2+3p_1^2p_2)z^4+ (3p_1p_2^2)z^5 + (p_2^3)z^6\\
    \end{aligned}\]</span>
To get a total of 4 children, either two of the fathers have 2 sons each and the third has no sons (<span class="math inline">\(p_0p_2^2\)</span>), or one of the fathers has 2 sons and the others each have 1 son (<span class="math inline">\(p_1^2p_2\)</span>). With three fathers, there are 3 ways for each of these combinations to appear; corresponding to the <span class="math inline">\(3p_0p_2^2+3p_1^2p_2\)</span> coefficient on <span class="math inline">\(z^4\)</span>.<br />
2. Multiply out <span class="math inline">\(h_2(z) = h(h(z))\)</span> algebraically and explain how the coefficient on <span class="math inline">\(z^2\)</span> consists of all of the possible ways for a woman to have 2 grand-daughters.
<span class="math display">\[\begin{aligned}
    h(h(z)) &amp; = p_0+p_1h(z)+p_2h(z)^2 \\
    &amp; = p_0 +p_1[p_0 + p_1 z + p_2 z^2] + p_2[p_0^2+2p_0p_1z+(2p_0p_2+p_1^2)z^2 + 2p_1p_2z^3 + p_2^2z^4] \\
    &amp;= [p_0+p_0p_1+p_0^2p_2] + [2p_0p_1p_2+p_1^2]z +\\
    &amp; [2p_0p_2^2+p_1p_2+p_1^2p_2]z^2 + [2p_1p_2^2]z^3+[p_2^3]z^4
    \end{aligned}\]</span>
Here are the ways a woman can end up with 2 granddaughters: first, she can have a single daughter who herself has 2 daughters (<span class="math inline">\(p_1p_2\)</span>). Or, she can have 2 daughters who then each have 1 daughter (<span class="math inline">\(p_1^2 p_2\)</span>). Lastly, she can have 2 daughters, one of which has 2 daughters and one who has no daughters (<span class="math inline">\(2p_0 p_2^2\)</span>; note there are two ways for this to happen because there are two daughters in the second generation). These possibilities correspond to the <span class="math inline">\(2p_0p_2^2+p_1p_2+p_1^2p_2\)</span> coefficient on <span class="math inline">\(z^2\)</span><br />
3. Write an R-program to reproduce 20 entries of the table (This is for our values of <span class="math inline">\(p_0 = 0.3\)</span>, <span class="math inline">\(p_1=0.3\)</span>, <span class="math inline">\(p_2=0.4\)</span>, not the <span class="math inline">\(p_k\)</span> values on wikipedia)</p>
<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th>Generation Number</th>
<th>Extinction probability</th>
<th>Generation Number</th>
<th>Extinction probability</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>0.30000</td>
<td>11</td>
<td>0.68599</td>
</tr>
<tr class="even">
<td>2</td>
<td>0.42600</td>
<td>12</td>
<td>0.69403</td>
</tr>
<tr class="odd">
<td>3</td>
<td>0.50039</td>
<td>13</td>
<td>0.70088</td>
</tr>
<tr class="even">
<td>4</td>
<td>0.55027</td>
<td>14</td>
<td>0.70676</td>
</tr>
<tr class="odd">
<td>5</td>
<td>0.58620</td>
<td>15</td>
<td>0.71183</td>
</tr>
<tr class="even">
<td>6</td>
<td>0.61331</td>
<td>16</td>
<td>0.71623</td>
</tr>
<tr class="odd">
<td>7</td>
<td>0.63446</td>
<td>17</td>
<td>0.72006</td>
</tr>
<tr class="even">
<td>8</td>
<td>0.65135</td>
<td>18</td>
<td>0.72342</td>
</tr>
<tr class="odd">
<td>9</td>
<td>0.66511</td>
<td>19</td>
<td>0.72636</td>
</tr>
<tr class="even">
<td>10</td>
<td>0.67648</td>
<td>20</td>
<td>0.72895</td>
</tr>
<tr class="odd">
<td>—</td>
<td>—</td>
<td>—</td>
<td>—</td>
</tr>
</tbody>
</table>
<p>The extinction probability is converging to 0.75 (going out to 50 or 60 generations is helpful for observing this).<br />
Sample code:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">d_zero &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2">p_zero &lt;-<span class="st"> </span><span class="fl">0.3</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3">p_one &lt;-<span class="st"> </span><span class="fl">0.3</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4">p_two &lt;-<span class="st"> </span><span class="fl">0.4</span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5">n_gen &lt;-<span class="st"> </span><span class="dv">20</span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"></a>
<a class="sourceLine" id="cb14-7" data-line-number="7">value_table &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, <span class="dt">nrow =</span> n_gen, <span class="dt">ncol =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb14-8" data-line-number="8"></a>
<a class="sourceLine" id="cb14-9" data-line-number="9">d_prev &lt;-<span class="st"> </span>d_zero</a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n_gen) {</a>
<a class="sourceLine" id="cb14-11" data-line-number="11">  prob_extinction &lt;-<span class="st"> </span>p_zero <span class="op">+</span><span class="st"> </span>d_prev<span class="op">*</span>p_one <span class="op">+</span><span class="st"> </span>(d_prev<span class="op">^</span><span class="dv">2</span>)<span class="op">*</span>p_two</a>
<a class="sourceLine" id="cb14-12" data-line-number="12">  value_table[i,<span class="dv">1</span>] =<span class="st"> </span>i</a>
<a class="sourceLine" id="cb14-13" data-line-number="13">  value_table[i, <span class="dv">2</span>] =<span class="st"> </span>prob_extinction</a>
<a class="sourceLine" id="cb14-14" data-line-number="14">  d_prev &lt;-<span class="st"> </span>prob_extinction</a>
<a class="sourceLine" id="cb14-15" data-line-number="15">}</a></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Use the quadratic formula to solve for <span class="math inline">\(d\)</span>, the probability of ultimate extinction: <span class="math inline">\(d = p_0 + p_1d + p_2d^2\)</span>. What do you get for <span class="math inline">\(d\)</span> given our <span class="math inline">\(p_k\)</span> values above? Does it correspond to the same value one gets by using iteration, as in the Wikipedia table?<br />
Do some rearranging of <span class="math inline">\(d = p_0 + p_1d + p_2d^2\)</span> to get: <span class="math display">\[0 = p_2d^2 +(p_1-1)d + p_0  \]</span><br />
Solving with the quadratic formula: <span class="math display">\[ d^* = {(1-p_1) \pm \sqrt{(p_1-1)^2 - 4p_2p_0}  \over 2p_2 } \]</span>
Filling in our given <span class="math inline">\(p_k\)</span> values:
<span class="math display">\[\begin{aligned}
 d^* &amp;= \frac{(1-0.3) \pm \sqrt{(0.3-1)^2 -4(0.4)(0.3)}}{2(0.4)} \\
 &amp;= \{0.75, 1\} 
 \end{aligned}\]</span><br />
Since <span class="math inline">\(m&gt;1\)</span>, there are two roots: 1 and 0.75. <span class="math inline">\(d=0.75\)</span> is the solution we are interested in, and it indeed agrees with the probability of the extinction that our iterative solution converges to.</li>
<li>Simulate a critical branching process such that m = 1 by reversing the <span class="math inline">\(p_1\)</span> and <span class="math inline">\(p_2\)</span> values we’re using. Check that <span class="math inline">\(m = 1\)</span>. You can use the “branch()” code in the slides.<br />
Let <span class="math inline">\(p_0=0.3\)</span>, <span class="math inline">\(p_1 =0.4\)</span>, <span class="math inline">\(p_2=0.3:\)</span>m = 0(0.3) + 1(0.4)+2(0.3) = 1$.
<ol style="list-style-type: lower-alpha">
<li>See if you can do a big number of trials, 1000? For many generations, 30, 50, 100?<br />
Sample simulation with 1000 trials for 100 generations (seed set to 91):
<div class="figure"><span id="fig:unnamed-chunk-47"></span>
<img src="figures/branch_simulation.png" alt="Branch simulation" width="100%" />
<p class="caption">
Figure 5.1: Branch simulation
</p>
</div></li>
<li>What fraction of lines become extinct?<br />
96.6% of lines become extinct by generation 100 with the above simulation. The following plot shows extinction at each generation:
<div class="figure"><span id="fig:unnamed-chunk-48"></span>
<img src="figures/extinctionplot.png" alt="Rate of extinction" width="100%" />
<p class="caption">
Figure 5.2: Rate of extinction
</p>
</div></li>
<li>What is the distribution of surviving lines? (Hint: Choose a time that is is not so distant that few lines survive)<br />
The following histograms show surviving lines’ sizes at select generations. At each generation, we can see something resembling a geometric distribution.
<div class="figure"><span id="fig:unnamed-chunk-49"></span>
<img src="figures/generation_dist.png" alt="Surviving generations" width="100%" />
<p class="caption">
Figure 5.3: Surviving generations
</p>
</div></li>
<li>What is the mean and variance of of <span class="math inline">\(Z_{10}\)</span>, <span class="math inline">\(Z_{20}\)</span> and <span class="math inline">\(Z_{30}\)</span>? What will happen as <span class="math inline">\(n \to \infty\)</span>?</li>
</ol></li>
</ol>
<table>
<thead>
<tr class="header">
<th>Generation <span class="math inline">\(n\)</span></th>
<th>Mean <span class="math inline">\(Z_n\)</span></th>
<th>Var <span class="math inline">\(Z_n\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10</td>
<td>1.009</td>
<td>5.20001</td>
</tr>
<tr class="even">
<td>20</td>
<td>1.012</td>
<td>10.7426</td>
</tr>
<tr class="odd">
<td>30</td>
<td>0.991</td>
<td>17.53045</td>
</tr>
</tbody>
</table>
<pre><code>    &lt;div class=&quot;figure&quot;&gt;
    &lt;img src=&quot;figures/meanvar.png&quot; alt=&quot;Survival mean and variance&quot; width=&quot;100%&quot; /&gt;
    &lt;p class=&quot;caption&quot;&gt;(\#fig:unnamed-chunk-50)Survival mean and variance&lt;/p&gt;
    &lt;/div&gt;
    The mean and variance calculated above account for all lines, not just surviving ones. In this simulation, the mean tends to hover around 1 and the variance tends to increase with generation number, at least up to a certain point.</code></pre>
<p>As <span class="math inline">\(n\to \infty\)</span>, the mean and variance theoretically will go to zero (since <span class="math inline">\(m=1\)</span> is critical, all lines must eventually die out).</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/gitbook-2.6.7/js/lunr.js"></script>
<script src="assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
