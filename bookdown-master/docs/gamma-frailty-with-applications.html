<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Gamma Frailty with Applications | Mathematical Demography</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Gamma Frailty with Applications | Mathematical Demography" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Gamma Frailty with Applications | Mathematical Demography" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Josh R. Goldstein" />


<meta name="date" content="2020-06-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="frailty.html"/>
<link rel="next" href="convergence-and-cross-overs.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction to Demographic Heterogeneity</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#outline"><i class="fa fa-check"></i><b>2.1</b> Outline</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#part-i.-conceptual-introduction"><i class="fa fa-check"></i><b>2.2</b> Part I. Conceptual Introduction</a><ul>
<li class="chapter" data-level="2.2.1" data-path="intro.html"><a href="intro.html#what-is-demographic-heterogeneity"><i class="fa fa-check"></i><b>2.2.1</b> What is Demographic Heterogeneity?</a></li>
<li class="chapter" data-level="2.2.2" data-path="intro.html"><a href="intro.html#an-example"><i class="fa fa-check"></i><b>2.2.2</b> An example</a></li>
<li class="chapter" data-level="2.2.3" data-path="intro.html"><a href="intro.html#a-2nd-example-exponential-growth-two-countries"><i class="fa fa-check"></i><b>2.2.3</b> A 2nd example: Exponential growth, two countries</a></li>
<li class="chapter" data-level="2.2.4" data-path="intro.html"><a href="intro.html#more-examples-to-work"><i class="fa fa-check"></i><b>2.2.4</b> More examples to work</a></li>
<li class="chapter" data-level="2.2.5" data-path="intro.html"><a href="intro.html#application"><i class="fa fa-check"></i><b>2.2.5</b> Application</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#part-ii.-formal-analysis"><i class="fa fa-check"></i><b>2.3</b> Part II. Formal Analysis</a><ul>
<li class="chapter" data-level="2.3.1" data-path="intro.html"><a href="intro.html#outline-1"><i class="fa fa-check"></i><b>2.3.1</b> Outline</a></li>
<li class="chapter" data-level="2.3.2" data-path="intro.html"><a href="intro.html#keyfitz-result"><i class="fa fa-check"></i><b>2.3.2</b> Keyfitz result</a></li>
<li class="chapter" data-level="2.3.3" data-path="intro.html"><a href="intro.html#us-mexico-example"><i class="fa fa-check"></i><b>2.3.3</b> US-Mexico Example</a></li>
<li class="chapter" data-level="2.3.4" data-path="intro.html"><a href="intro.html#the-origin-of-professor-wachters-poisson-exponential-model"><i class="fa fa-check"></i><b>2.3.4</b> The Origin of Professor Wachter’s Poisson-Exponential Model</a></li>
<li class="chapter" data-level="2.3.5" data-path="intro.html"><a href="intro.html#some-commentary"><i class="fa fa-check"></i><b>2.3.5</b> Some commentary</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#conclusions"><i class="fa fa-check"></i><b>2.4</b> Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="frailty.html"><a href="frailty.html"><i class="fa fa-check"></i><b>3</b> Multiplicative Fixed Frailty</a><ul>
<li class="chapter" data-level="3.1" data-path="frailty.html"><a href="frailty.html#outline-2"><i class="fa fa-check"></i><b>3.1</b> Outline</a><ul>
<li class="chapter" data-level="3.1.1" data-path="frailty.html"><a href="frailty.html#review-of-mortality-mathematics"><i class="fa fa-check"></i><b>3.1.1</b> Review of mortality mathematics</a></li>
<li class="chapter" data-level="3.1.2" data-path="frailty.html"><a href="frailty.html#application-what-is-ellx"><i class="fa fa-check"></i><b>3.1.2</b> Application: what is <span class="math inline">\(\ell&#39;(x)\)</span>?</a></li>
<li class="chapter" data-level="3.1.3" data-path="frailty.html"><a href="frailty.html#extending-keyfitz-to-mortality"><i class="fa fa-check"></i><b>3.1.3</b> Extending Keyfitz to mortality</a></li>
<li class="chapter" data-level="3.1.4" data-path="frailty.html"><a href="frailty.html#fragile"><i class="fa fa-check"></i><b>3.1.4</b> fragile</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="frailty.html"><a href="frailty.html#part-i.-results-from-fixed-frailty"><i class="fa fa-check"></i><b>3.2</b> Part I. Results from Fixed Frailty</a><ul>
<li class="chapter" data-level="3.2.1" data-path="frailty.html"><a href="frailty.html#a-simulation"><i class="fa fa-check"></i><b>3.2.1</b> A simulation</a></li>
<li class="chapter" data-level="3.2.2" data-path="frailty.html"><a href="frailty.html#lets-derive-pop-survival-note-bars-barell"><i class="fa fa-check"></i><b>3.2.2</b> Let’s derive pop survival (Note: <span class="math inline">\(\bar{s} = \bar{\ell}\)</span>)</a></li>
<li class="chapter" data-level="3.2.3" data-path="frailty.html"><a href="frailty.html#now-population-hazards-stepping-stones"><i class="fa fa-check"></i><b>3.2.3</b> Now population hazards (stepping stones)</a></li>
<li class="chapter" data-level="3.2.4" data-path="frailty.html"><a href="frailty.html#rodriguez-question"><i class="fa fa-check"></i><b>3.2.4</b> Rodriguez question</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="frailty.html"><a href="frailty.html#part-ii.-introduction-to-gamma-frailty"><i class="fa fa-check"></i><b>3.3</b> Part II. Introduction to Gamma Frailty</a><ul>
<li class="chapter" data-level="3.3.1" data-path="frailty.html"><a href="frailty.html#the-gamma-distribution"><i class="fa fa-check"></i><b>3.3.1</b> The Gamma distribution</a></li>
<li class="chapter" data-level="3.3.2" data-path="frailty.html"><a href="frailty.html#gamma-in-r"><i class="fa fa-check"></i><b>3.3.2</b> Gamma in R</a></li>
<li class="chapter" data-level="3.3.3" data-path="frailty.html"><a href="frailty.html#population-survival-of-gamma-frailty"><i class="fa fa-check"></i><b>3.3.3</b> Population Survival of Gamma Frailty</a></li>
<li class="chapter" data-level="3.3.4" data-path="frailty.html"><a href="frailty.html#interpreting-gamma-frailty-survival"><i class="fa fa-check"></i><b>3.3.4</b> Interpreting Gamma-frailty survival</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="frailty.html"><a href="frailty.html#conclusions-1"><i class="fa fa-check"></i><b>3.4</b> Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="gamma-frailty-with-applications.html"><a href="gamma-frailty-with-applications.html"><i class="fa fa-check"></i><b>4</b> Gamma Frailty with Applications</a><ul>
<li class="chapter" data-level="4.1" data-path="gamma-frailty-with-applications.html"><a href="gamma-frailty-with-applications.html#from-pop-survival-to-pop-hazards"><i class="fa fa-check"></i><b>4.1</b> From pop survival to pop hazards</a><ul>
<li class="chapter" data-level="4.1.1" data-path="gamma-frailty-with-applications.html"><a href="gamma-frailty-with-applications.html#what-happens-to-frailty-of-survivors"><i class="fa fa-check"></i><b>4.1.1</b> What happens to frailty of survivors?</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="gamma-frailty-with-applications.html"><a href="gamma-frailty-with-applications.html#selection-and-observed-frailty-in-censoc"><i class="fa fa-check"></i><b>4.2</b> Selection and observed frailty in CenSoc</a><ul>
<li class="chapter" data-level="4.2.1" data-path="gamma-frailty-with-applications.html"><a href="gamma-frailty-with-applications.html#read-in-the-data-and-transform-the-variables-to-what-we-want.-we-produce-a-variable-y-in-this-case-a-standardized-version-of-log-wage-income-to-be-transformed-into-a-frailty-score."><i class="fa fa-check"></i><b>4.2.1</b> Read in the data and transform the variables to what we want. We produce a variable <span class="math inline">\(y\)</span> (in this case a standardized version of log wage income) to be transformed into a frailty score.</a></li>
<li class="chapter" data-level="4.2.2" data-path="gamma-frailty-with-applications.html"><a href="gamma-frailty-with-applications.html#show-how-our-life-long-fixed-characteristic-of-interest-changes-by-age-because-of-mortality-selection."><i class="fa fa-check"></i><b>4.2.2</b> Show how our (life-long fixed) characteristic of interest changes by age because of mortality selection.</a></li>
<li class="chapter" data-level="4.2.3" data-path="gamma-frailty-with-applications.html"><a href="gamma-frailty-with-applications.html#estimate-an-observed-frailty-for-each-person-call-this-z_obs-to-do-this-we-first-use-cox-regression-to-estimate-the-proportional-effect-of-y-on-hazards.-the-cox-model-has-the-form"><i class="fa fa-check"></i><b>4.2.3</b> Estimate an observed frailty for each person, call this <span class="math inline">\(z_{obs}\)</span> To do this we first use Cox regression to estimate the proportional effect of <span class="math inline">\(y\)</span> on hazards. The Cox model has the form</a></li>
<li class="chapter" data-level="4.2.4" data-path="gamma-frailty-with-applications.html"><a href="gamma-frailty-with-applications.html#calculate-the-variance-of-z_obs-to-be-used-for-estimating-barz_obs.-also-plot-the-histogram-to-see-if-it-looks-gamma-like"><i class="fa fa-check"></i><b>4.2.4</b> Calculate the variance of <span class="math inline">\(z_{obs}\)</span> to be used for estimating <span class="math inline">\(\bar{z}_{obs}\)</span>. (Also plot the histogram to see if it looks gamma-like)</a></li>
<li class="chapter" data-level="4.2.5" data-path="gamma-frailty-with-applications.html"><a href="gamma-frailty-with-applications.html#use-extinct-cohort-method-to-estimate-survivorship-barsx"><i class="fa fa-check"></i><b>4.2.5</b> Use extinct cohort method to estimate survivorship <span class="math inline">\(\bar{S}(x)\)</span></a></li>
<li class="chapter" data-level="4.2.6" data-path="gamma-frailty-with-applications.html"><a href="gamma-frailty-with-applications.html#estimate-hatbarzx-using-the-gamma-frailty-result"><i class="fa fa-check"></i><b>4.2.6</b> Estimate <span class="math inline">\(\hat{\bar{z}}(x)\)</span> using the gamma-frailty result:</a></li>
<li class="chapter" data-level="4.2.7" data-path="gamma-frailty-with-applications.html"><a href="gamma-frailty-with-applications.html#graph-our-results-showing-plots-for-observed-mortality-selection-and-the-gamma-frailty-based-estimate-of-mortality-selection.-do-this-for-several-measures-including-y-and-raw-unstandardized-income."><i class="fa fa-check"></i><b>4.2.7</b> Graph our results, showing plots for observed mortality selection and the gamma-frailty based estimate of mortality selection. Do this for several measures including <span class="math inline">\(y\)</span>, and raw (unstandardized) income.</a></li>
<li class="chapter" data-level="4.2.8" data-path="gamma-frailty-with-applications.html"><a href="gamma-frailty-with-applications.html#discuss-our-conclusions-and-possible-future-directions-to-follow."><i class="fa fa-check"></i><b>4.2.8</b> Discuss our conclusions and possible future directions to follow.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="convergence-and-cross-overs.html"><a href="convergence-and-cross-overs.html"><i class="fa fa-check"></i><b>5</b> Convergence and cross-overs</a><ul>
<li class="chapter" data-level="5.1" data-path="convergence-and-cross-overs.html"><a href="convergence-and-cross-overs.html#outline-3"><i class="fa fa-check"></i><b>5.1</b> Outline</a></li>
<li class="chapter" data-level="5.2" data-path="convergence-and-cross-overs.html"><a href="convergence-and-cross-overs.html#what-happens-to-mortality-disparities-at-older-ages"><i class="fa fa-check"></i><b>5.2</b> What happens to mortality disparities at older ages?</a><ul>
<li class="chapter" data-level="5.2.1" data-path="convergence-and-cross-overs.html"><a href="convergence-and-cross-overs.html#a-possible-null-model"><i class="fa fa-check"></i><b>5.2.1</b> A possible null-model</a></li>
<li class="chapter" data-level="5.2.2" data-path="convergence-and-cross-overs.html"><a href="convergence-and-cross-overs.html#a-result-5e"><i class="fa fa-check"></i><b>5.2.2</b> A result: (5E)</a></li>
<li class="chapter" data-level="5.2.3" data-path="convergence-and-cross-overs.html"><a href="convergence-and-cross-overs.html#inversion"><i class="fa fa-check"></i><b>5.2.3</b> Inversion</a></li>
<li class="chapter" data-level="5.2.4" data-path="convergence-and-cross-overs.html"><a href="convergence-and-cross-overs.html#an-example-1"><i class="fa fa-check"></i><b>5.2.4</b> An example</a></li>
<li class="chapter" data-level="5.2.5" data-path="convergence-and-cross-overs.html"><a href="convergence-and-cross-overs.html#application-1"><i class="fa fa-check"></i><b>5.2.5</b> Application</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="convergence-and-cross-overs.html"><a href="convergence-and-cross-overs.html#student-presentation"><i class="fa fa-check"></i><b>5.3</b> Student Presentation</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="mortality-plateaus.html"><a href="mortality-plateaus.html"><i class="fa fa-check"></i><b>6</b> Mortality plateaus</a><ul>
<li class="chapter" data-level="6.1" data-path="mortality-plateaus.html"><a href="mortality-plateaus.html#outline-4"><i class="fa fa-check"></i><b>6.1</b> Outline</a></li>
<li class="chapter" data-level="6.2" data-path="mortality-plateaus.html"><a href="mortality-plateaus.html#heterogeneity-slows-mortality-improvement"><i class="fa fa-check"></i><b>6.2</b> Heterogeneity slows mortality improvement</a><ul>
<li class="chapter" data-level="6.2.1" data-path="mortality-plateaus.html"><a href="mortality-plateaus.html#an-example-2"><i class="fa fa-check"></i><b>6.2.1</b> An example</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="mortality-plateaus.html"><a href="mortality-plateaus.html#conclusions-2"><i class="fa fa-check"></i><b>6.3</b> Conclusions</a></li>
<li class="chapter" data-level="6.4" data-path="mortality-plateaus.html"><a href="mortality-plateaus.html#kens-class"><i class="fa fa-check"></i><b>6.4</b> Ken’s class</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="tempo.html"><a href="tempo.html"><i class="fa fa-check"></i><b>7</b> Tempo</a><ul>
<li class="chapter" data-level="7.1" data-path="tempo.html"><a href="tempo.html#outline-5"><i class="fa fa-check"></i><b>7.1</b> Outline</a></li>
<li class="chapter" data-level="7.2" data-path="tempo.html"><a href="tempo.html#summary"><i class="fa fa-check"></i><b>7.2</b> Summary</a><ul>
<li class="chapter" data-level="7.2.1" data-path="tempo.html"><a href="tempo.html#what-we-see-is-superficial.-heterogeneous-models-reveal-whats-really-going-on.-or-do-they-wwill-reverse-perspectives-fertility-postponement-a-very-simple-example-continuous-postponement-a-shiny-simulation-period-shifts-bongaarts-and-feeneys-model-an-example-a-derivation-due-to-rodriguez-quantum-comes-at-the-end-tempo-adjusted-tfr-counter-factual-tfr-in-absence-of-timing-changes-how-do-period-schedules-change-uniform-shifts"><i class="fa fa-check"></i><b>7.2.1</b> What we see is superficial. Heterogeneous models reveal what’s <code>really'' going on. (Or do they?) ### Wwill reverse perspectives ## Fertility postponement, a very simple example ### Continuous postponement, a shiny simulation ## Period Shifts: Bongaarts and Feeney's model ### An example ## A derivation: due to Rodriguez ### Quantum comes at the end ### Tempo-adjusted TFR: counter-factual, TFR in absence of timing changes ### How do period schedules change? ##</code>Uniform’’ shifts</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="tempo.html"><a href="tempo.html#bf-recommendation-for-achieving-uniformity"><i class="fa fa-check"></i><b>7.3</b> BF recommendation for achieving uniformity</a></li>
<li class="chapter" data-level="7.4" data-path="tempo.html"><a href="tempo.html#an-application-to-the-united-states"><i class="fa fa-check"></i><b>7.4</b> An Application to the United States</a></li>
<li class="chapter" data-level="7.5" data-path="tempo.html"><a href="tempo.html#two-americas"><i class="fa fa-check"></i><b>7.5</b> Two Americas</a><ul>
<li class="chapter" data-level="7.5.1" data-path="tempo.html"><a href="tempo.html#an-algorithm-for-tempo-adjustment-of-mixtures"><i class="fa fa-check"></i><b>7.5.1</b> An algorithm for tempo adjustment of mixtures</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="tempo.html"><a href="tempo.html#conclusions-3"><i class="fa fa-check"></i><b>7.6</b> Conclusions</a><ul>
<li class="chapter" data-level="7.6.1" data-path="tempo.html"><a href="tempo.html#caveats"><i class="fa fa-check"></i><b>7.6.1</b> Caveats</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="branching-processes.html"><a href="branching-processes.html"><i class="fa fa-check"></i><b>8</b> Branching Processes</a><ul>
<li class="chapter" data-level="8.1" data-path="branching-processes.html"><a href="branching-processes.html#outline-6"><i class="fa fa-check"></i><b>8.1</b> Outline</a></li>
<li class="chapter" data-level="8.2" data-path="branching-processes.html"><a href="branching-processes.html#motivation"><i class="fa fa-check"></i><b>8.2</b> Motivation</a><ul>
<li class="chapter" data-level="8.2.1" data-path="branching-processes.html"><a href="branching-processes.html#very-brief-history-of-branching-processes"><i class="fa fa-check"></i><b>8.2.1</b> Very brief history of Branching Processes</a></li>
<li class="chapter" data-level="8.2.2" data-path="branching-processes.html"><a href="branching-processes.html#applicability-to-the-coronavirus-yes-and-no."><i class="fa fa-check"></i><b>8.2.2</b> Applicability to the Coronavirus? Yes and no.</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="branching-processes.html"><a href="branching-processes.html#simulated-examples-and-the-questions-they-raise"><i class="fa fa-check"></i><b>8.3</b> Simulated examples and the questions they raise</a><ul>
<li class="chapter" data-level="8.3.1" data-path="branching-processes.html"><a href="branching-processes.html#our-viral-example"><i class="fa fa-check"></i><b>8.3.1</b> Our viral example</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="branching-processes.html"><a href="branching-processes.html#what-is-a-bienayme-galton-watson-branching-process"><i class="fa fa-check"></i><b>8.4</b> What is a (Bienaym'e-)Galton-Watson branching process?</a></li>
<li class="chapter" data-level="8.5" data-path="branching-processes.html"><a href="branching-processes.html#simulations"><i class="fa fa-check"></i><b>8.5</b> Simulations</a></li>
<li class="chapter" data-level="8.6" data-path="branching-processes.html"><a href="branching-processes.html#extinction-vs-breakout"><i class="fa fa-check"></i><b>8.6</b> “Extinction” vs “breakout”</a><ul>
<li class="chapter" data-level="8.6.1" data-path="branching-processes.html"><a href="branching-processes.html#the-probability-generating-function-our-mathematical-tool"><i class="fa fa-check"></i><b>8.6.1</b> The Probability Generating Function: Our mathematical tool</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="branching-processes.html"><a href="branching-processes.html#good-and-bad-set-ups-for-branching-process"><i class="fa fa-check"></i><b>8.7</b> Good and bad set-ups for branching process</a></li>
<li class="chapter" data-level="8.8" data-path="branching-processes.html"><a href="branching-processes.html#insert-code-here-for-zn_surv_bar.hat-and-add-a-line"><i class="fa fa-check"></i><b>8.8</b> insert code here for Zn_surv_bar.hat and add a line</a></li>
<li class="chapter" data-level="8.9" data-path="branching-processes.html"><a href="branching-processes.html#insert-code-here-for-zn_surv_bar.hat-and-add-a-line-1"><i class="fa fa-check"></i><b>8.9</b> insert code here for Zn_surv_bar.hat and add a line</a></li>
<li class="chapter" data-level="8.10" data-path="branching-processes.html"><a href="branching-processes.html#b-0.2126-c-0.5893-lotka"><i class="fa fa-check"></i><b>8.10</b> b = 0.2126 ; c = 0.5893 ## lotka</a></li>
<li class="chapter" data-level="8.11" data-path="branching-processes.html"><a href="branching-processes.html#b-0.2126-c-0.5893-lotka-1"><i class="fa fa-check"></i><b>8.11</b> b = 0.2126 ; c = 0.5893 ## lotka</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Mathematical Demography</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="gamma-frailty-with-applications" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Gamma Frailty with Applications</h1>
<div id="from-pop-survival-to-pop-hazards" class="section level2">
<h2><span class="header-section-number">4.1</span> From pop survival to pop hazards</h2>
<p>We have
<span class="math display">\[
  \bar S(x) = {1 \over  \left(1 + \sigma^2 H_0(x)\right)^{1/ \sigma^2}}
  \]</span></p>
<p>Let’s compute <span class="math inline">\(\bar\mu(x)\)</span>.</p>
<p><span class="math display">\[
  \bar\mu(x) = {\mu_0 \over 1 + \sigma^2 H_0(x)}
  \]</span></p>
<div id="what-happens-to-frailty-of-survivors" class="section level3">
<h3><span class="header-section-number">4.1.1</span> What happens to frailty of survivors?</h3>
<p>Recall that pop hazards = baseline <span class="math inline">\(\times \bar{z}(x)\)</span>.</p>
<p>So,
<span class="math display">\[
  \bar\mu(x) = \mu_0(x) { 1  \over 1 + \sigma^2 H_0(x)}
  \]</span>
Sketch <span class="math inline">\(\bar{z}(x)\)</span>. Hint: what form does <span class="math inline">\(H_0(x)\)</span> have?</p>
<div id="example-gamma-gompertz" class="section level4">
<h4><span class="header-section-number">4.1.1.1</span> Example: Gamma-Gompertz</h4>

If <span class="math inline">\(H_0(x)\)</span> be Gompertz, we have closed-form
expression. What is it?

Does <span class="math inline">\(\bar{z}\)</span> have the form
<span class="math display">\[
    {1 \over 1 + v*e^{w x}}
    \]</span>

<p>This is a backwards S, going down.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">sigma.sq =<span class="st"> </span><span class="fl">.2</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">x =<span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">100</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">a =<span class="st"> </span><span class="dv">5</span> <span class="op">*</span><span class="st"> </span><span class="dv">10</span><span class="op">^-</span><span class="dv">4</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">b =<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">8</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">H0.x =<span class="st"> </span>(a<span class="op">/</span>b) <span class="op">*</span><span class="st"> </span>(<span class="kw">exp</span>(b<span class="op">*</span>x) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">bar.z =<span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>sigma.sq <span class="op">*</span><span class="st"> </span>H0.x)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw">plot</span>(x, bar.z)</a></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-1-1.png" width="672" />
Look at the apparent exponential decline in tail
Homework: what is proportional rate of change in <span class="math inline">\(\bar{z}\)</span> as <span class="math inline">\(x\)</span>
gets big? Is it close to Gompertz <span class="math inline">\(b\)</span>?</p>
<p>Average frailty in terms of survival</p>
<p><span class="math display">\[ 
  \bar{z}(x) = [\bar{S}(x)]^{\sigma^2}!
  \]</span></p>
<p>In real life, we observe <span class="math inline">\(\bar{S}(x)\)</span>. So this allows us to say
something about implied <span class="math inline">\(\bar{z}\)</span> from hazards.</p>
<p>Reversing the logic: if we see a characteristic changing with age,
then we can estimate ``<span class="math inline">\({\sigma^2}\)</span>’’ (I put in quotes because its
the variance of the proportional effect of the observed
characteristic.)</p>
</div>
</div>
</div>
<div id="selection-and-observed-frailty-in-censoc" class="section level2">
<h2><span class="header-section-number">4.2</span> Selection and observed frailty in CenSoc</h2>
<p>We have a large matched sample from the 1940 census to Social Security death data observed from 1975 to 2004. This means that we can compute the survival curves of extinct cohorts and see how mortality selection changes the composition of the cohort as it ages.</p>
<p>In this example, we use observed wage income in 1940 for the cohort born 1895 to 1900. We look at how wages of survivors increase with age as a result of selective mortality and we see if the gamma-frailty model can produce similar results.</p>
<div id="read-in-the-data-and-transform-the-variables-to-what-we-want.-we-produce-a-variable-y-in-this-case-a-standardized-version-of-log-wage-income-to-be-transformed-into-a-frailty-score." class="section level3">
<h3><span class="header-section-number">4.2.1</span> Read in the data and transform the variables to what we want. We produce a variable <span class="math inline">\(y\)</span> (in this case a standardized version of log wage income) to be transformed into a frailty score.</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co">## read in dat</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">library</span>(data.table)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">dt &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;/data/josh/CenSoc/censoc_bfdw.csv&quot;</span>)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">## Clean wage data</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">dt[, incwage <span class="op">:</span><span class="er">=</span><span class="st"> </span>INCWAGE]</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">dt[incwage <span class="op">==</span><span class="st"> </span><span class="dv">999998</span>, incwage <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="ot">NA</span>]</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">dt[incwage <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, incwage <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="ot">NA</span>]</a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">hist_incwage &lt;-<span class="st"> </span>dt[, <span class="kw">hist</span>(incwage)]</a></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">hist_ln_incwage &lt;-<span class="st"> </span>dt[, <span class="kw">hist</span>(<span class="kw">log</span>(incwage))]</a></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-3-2.png" width="672" /></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co">## Do age at death for 1895-1900 cohorts</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">dt[, age.at.death <span class="op">:</span><span class="er">=</span><span class="st"> </span>dyear <span class="op">+</span><span class="st"> </span>dmonth<span class="op">/</span><span class="dv">12</span> <span class="op">-</span><span class="st"> </span>(byear <span class="op">+</span><span class="st"> </span>bmonth<span class="op">/</span><span class="dv">12</span>)]</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">my.dt &lt;-<span class="st"> </span>dt[byear <span class="op">%in%</span><span class="st"> </span><span class="dv">1895</span><span class="op">:</span><span class="dv">1900</span> <span class="op">&amp;</span><span class="st"> </span>dyear <span class="op">%in%</span><span class="st"> </span><span class="dv">1975</span><span class="op">:</span><span class="dv">2004</span>]</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">## now limits to deaths younger than 105</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5">my.dt[, <span class="kw">max</span>(age.at.death), by =<span class="st"> </span>byear]</a></code></pre></div>
<pre><code>##    byear       V1
## 1:  1900 104.9167
## 2:  1898 106.8333
## 3:  1897 107.0833
## 4:  1895 109.4167
## 5:  1899 105.6667
## 6:  1896 107.9167</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">nrow</span>(my.dt[age.at.death <span class="op">&gt;=</span><span class="st"> </span><span class="dv">105</span>])</a></code></pre></div>
<pre><code>## [1] 177</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">nrow</span>(my.dt[<span class="kw">floor</span>(age.at.death) <span class="op">==</span><span class="st"> </span><span class="dv">104</span>])</a></code></pre></div>
<pre><code>## [1] 253</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co">## now we have same age range for every cohort</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2">my.dt &lt;-<span class="st"> </span>my.dt[age.at.death <span class="op">&lt;</span><span class="st"> </span><span class="dv">105</span>]</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">my.dt &lt;-<span class="st"> </span>my.dt[<span class="op">!</span><span class="kw">is.na</span>(incwage)] <span class="co">## keep only non-missing </span></a></code></pre></div>
<p>Log-wages look reasonable, unimodal, kind of symmetric. We now center our variable to 0 before estimating the effect on mortality. Our model exponentiates this 0 to become 1, which is where we want our frailty measure to be centered.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co">## standardized log income</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="co">## log_inc_stan = log(y_orig) - mean(log(y_orig))</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="co">## note: control for byear, since different ages in 1940</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4">my.dt[, y_orig <span class="op">:</span><span class="er">=</span><span class="st"> </span>incwage]</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">my.dt[, log_inc <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">log</span>(incwage)]</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">my.dt[, log_inc_mean <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">mean</span>(log_inc), by =<span class="st"> </span>byear]</a>
<a class="sourceLine" id="cb12-7" data-line-number="7">my.dt[, y <span class="op">:</span><span class="er">=</span><span class="st"> </span>log_inc <span class="op">-</span><span class="st"> </span>log_inc_mean]</a>
<a class="sourceLine" id="cb12-8" data-line-number="8">hist_y &lt;-<span class="st"> </span>my.dt[, <span class="kw">hist</span>(y)]</a></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">my.dt[, <span class="kw">summary</span>(y)]</a></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
## -7.0542 -0.4159  0.1661  0.0000  0.5660  4.2460</code></pre>
<p>Now we’re centered at 0.</p>
</div>
<div id="show-how-our-life-long-fixed-characteristic-of-interest-changes-by-age-because-of-mortality-selection." class="section level3">
<h3><span class="header-section-number">4.2.2</span> Show how our (life-long fixed) characteristic of interest changes by age because of mortality selection.</h3>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">my.dt[, <span class="kw">plot</span>(x, y_orig.bar)]</a></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">title</span>(<span class="st">&quot;Wage income by surviving age&quot;</span>, <span class="dt">cex.main =</span> <span class="fl">.7</span>)</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">my.dt[, <span class="kw">plot</span>(x, y.bar)]</a></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">title</span>(<span class="st">&quot;Standardized log of Wage income by surviving age&quot;</span>, <span class="dt">cex.main =</span> <span class="fl">.7</span>)</a></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>So we see annual wage income in 1940 increases by about $100 or so, or about 5% from age 75 to age 95. And more after that.</p>
<blockquote>
<p>Is this what we would expect from our Gamma frailty model?</p>
</blockquote>
</div>
<div id="estimate-an-observed-frailty-for-each-person-call-this-z_obs-to-do-this-we-first-use-cox-regression-to-estimate-the-proportional-effect-of-y-on-hazards.-the-cox-model-has-the-form" class="section level3">
<h3><span class="header-section-number">4.2.3</span> Estimate an observed frailty for each person, call this <span class="math inline">\(z_{obs}\)</span> To do this we first use Cox regression to estimate the proportional effect of <span class="math inline">\(y\)</span> on hazards. The Cox model has the form</h3>
<p><span class="math display">\[
\mu_i(x) = \mu_0(x) e^{\beta  y}
\]</span></p>
<p>We can then transform <span class="math inline">\(y\)</span> into a frailty score <span class="math inline">\(z_{obs}\)</span>, letting
<span class="math display">\[
z_{obs} = e^{\hat\beta  y}
\]</span></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="co">## now get z&#39;s</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="kw">library</span>(survival)</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">my.dt[, event <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="dv">1</span>]</a>
<a class="sourceLine" id="cb20-4" data-line-number="4">m &lt;-<span class="st"> </span><span class="kw">coxph</span>(<span class="kw">Surv</span>(age.at.death, event) <span class="op">~</span><span class="st"> </span>y, <span class="dt">data =</span> my.dt)</a>
<a class="sourceLine" id="cb20-5" data-line-number="5">(<span class="kw">summary</span>(m))</a></code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(age.at.death, event) ~ y, data = my.dt)
## 
##   n= 402797, number of events= 402797 
## 
##       coef exp(coef) se(coef)      z Pr(&gt;|z|)    
## y -0.03073   0.96974  0.00177 -17.36   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
##   exp(coef) exp(-coef) lower .95 upper .95
## y    0.9697      1.031    0.9664    0.9731
## 
## Concordance= 0.512  (se = 0.001 )
## Likelihood ratio test= 298  on 1 df,   p=&lt;2e-16
## Wald test            = 301.5  on 1 df,   p=&lt;2e-16
## Score (logrank) test = 301.5  on 1 df,   p=&lt;2e-16</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="co">##                      coef exp(coef) se(coef)      z Pr(&gt;|z|)</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="co">## y -0.03073   0.96974  0.00177 -17.36   &lt;2e-16 ***</span></a>
<a class="sourceLine" id="cb22-3" data-line-number="3"><span class="co">## so a 10% increase in income reduces mortality by .3% (quite a tiny effect!)</span></a>
<a class="sourceLine" id="cb22-4" data-line-number="4">beta &lt;-<span class="st"> </span><span class="kw">coef</span>(m)</a></code></pre></div>
<blockquote>
<p>The effect is very small. Any ideas why?</p>
</blockquote>
<p>Now estimate our z’s.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">my.dt[, z <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">exp</span>(beta <span class="op">*</span><span class="st"> </span>y)]</a>
<a class="sourceLine" id="cb23-2" data-line-number="2">hist_z &lt;-<span class="st"> </span>my.dt[, <span class="kw">hist</span>(z, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">3</span>))]</a></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<blockquote>
<p>Does this look gamma-like?</p>
</blockquote>
</div>
<div id="calculate-the-variance-of-z_obs-to-be-used-for-estimating-barz_obs.-also-plot-the-histogram-to-see-if-it-looks-gamma-like" class="section level3">
<h3><span class="header-section-number">4.2.4</span> Calculate the variance of <span class="math inline">\(z_{obs}\)</span> to be used for estimating <span class="math inline">\(\bar{z}_{obs}\)</span>. (Also plot the histogram to see if it looks gamma-like)</h3>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">sigma.sq &lt;-<span class="st"> </span><span class="kw">var</span>(my.dt<span class="op">$</span>z)</a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="kw">print</span>(sigma.sq)</a></code></pre></div>
<pre><code>## [1] 0.000745355</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw">print</span>(<span class="kw">sqrt</span>(sigma.sq))</a></code></pre></div>
<pre><code>## [1] 0.02730119</code></pre>
<blockquote>
<p>Check SD against histogram. Does it look right?</p>
</blockquote>
</div>
<div id="use-extinct-cohort-method-to-estimate-survivorship-barsx" class="section level3">
<h3><span class="header-section-number">4.2.5</span> Use extinct cohort method to estimate survivorship <span class="math inline">\(\bar{S}(x)\)</span></h3>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">Dx &lt;-<span class="st"> </span>my.dt[, <span class="kw">table</span>(<span class="kw">floor</span>(age.at.death))]</a>
<a class="sourceLine" id="cb28-2" data-line-number="2"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb28-3" data-line-number="3"><span class="kw">plot</span>(Dx)</a>
<a class="sourceLine" id="cb28-4" data-line-number="4">lx &lt;-<span class="st"> </span><span class="kw">rev</span>(<span class="kw">cumsum</span>(<span class="kw">rev</span>(Dx)))</a>
<a class="sourceLine" id="cb28-5" data-line-number="5">lxpn &lt;-<span class="st"> </span><span class="kw">c</span>(lx[<span class="op">-</span><span class="dv">1</span>],<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb28-6" data-line-number="6">Lx &lt;-<span class="st"> </span>(lx <span class="op">+</span><span class="st"> </span>lxpn)<span class="op">/</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb28-7" data-line-number="7">mx &lt;-<span class="st"> </span>Dx<span class="op">/</span>Lx</a>
<a class="sourceLine" id="cb28-8" data-line-number="8">x &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">names</span>(Dx))</a>
<a class="sourceLine" id="cb28-9" data-line-number="9"><span class="kw">plot</span>(x, <span class="kw">log</span>(mx), <span class="dt">type =</span> <span class="st">&quot;p&quot;</span>)</a>
<a class="sourceLine" id="cb28-10" data-line-number="10"><span class="co">## gomp fit from ages 80 to 95</span></a>
<a class="sourceLine" id="cb28-11" data-line-number="11">m &lt;-<span class="st"> </span><span class="kw">lm</span> (<span class="kw">log</span>(mx) <span class="op">~</span><span class="st"> </span>x, <span class="dt">subset =</span> x <span class="op">%in%</span><span class="st"> </span><span class="dv">80</span><span class="op">:</span><span class="dv">100</span>)</a>
<a class="sourceLine" id="cb28-12" data-line-number="12"><span class="kw">lines</span>(<span class="dv">80</span><span class="op">:</span><span class="dv">100</span>, <span class="kw">predict</span>(m), <span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb28-13" data-line-number="13"><span class="kw">axis</span>(<span class="dv">2</span>)</a></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="co">## no slowdown in mortality!!</span></a></code></pre></div>
<blockquote>
<p>How does Dx look? Plausible?</p>
</blockquote>
<blockquote>
<p>How about hazards? They are Gompertzian for a while, but how do we explain tails?</p>
</blockquote>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="kw">plot</span>(x, lx)</a></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
</div>
<div id="estimate-hatbarzx-using-the-gamma-frailty-result" class="section level3">
<h3><span class="header-section-number">4.2.6</span> Estimate <span class="math inline">\(\hat{\bar{z}}(x)\)</span> using the gamma-frailty result:</h3>
<p><span class="math display">\[
\bar{z}(x) = \bar{S}(x)^{\sigma^2}
\]</span></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1">sx.bar &lt;-<span class="st"> </span>lx<span class="op">/</span>lx[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb31-2" data-line-number="2">z.bar.hat &lt;-<span class="st"> </span>sx.bar<span class="op">^</span>sigma.sq</a></code></pre></div>
<p>Compare this to our observed <span class="math inline">\(\bar{z}\)</span></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="dv">74</span><span class="op">:</span><span class="dv">104</span></a>
<a class="sourceLine" id="cb32-2" data-line-number="2">z.bar &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb32-3" data-line-number="3"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(x))</a>
<a class="sourceLine" id="cb32-4" data-line-number="4">{</a>
<a class="sourceLine" id="cb32-5" data-line-number="5">    z.bar[i] &lt;-<span class="st"> </span>my.dt[age.at.death <span class="op">&gt;</span><span class="st"> </span>x[i], <span class="kw">mean</span>(z)]</a>
<a class="sourceLine" id="cb32-6" data-line-number="6">}</a></code></pre></div>
<p>Plot comparison</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="kw">plot</span>(x, z.bar.hat, <span class="dt">ylim =</span> <span class="kw">c</span>(.<span class="dv">995</span>, <span class="fl">1.001</span>), <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb33-2" data-line-number="2"><span class="kw">lines</span>(x, z.bar)</a></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<blockquote>
<p>How did we do?</p>
</blockquote>
<blockquote>
<p>I’m not quite sure why intercept of observed is not exactly 1.0. (Feel free to play around, but I don’t think this is important – I hope.)</p>
</blockquote>
</div>
<div id="graph-our-results-showing-plots-for-observed-mortality-selection-and-the-gamma-frailty-based-estimate-of-mortality-selection.-do-this-for-several-measures-including-y-and-raw-unstandardized-income." class="section level3">
<h3><span class="header-section-number">4.2.7</span> Graph our results, showing plots for observed mortality selection and the gamma-frailty based estimate of mortality selection. Do this for several measures including <span class="math inline">\(y\)</span>, and raw (unstandardized) income.</h3>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">y.bar.hat &lt;-<span class="st"> </span><span class="kw">log</span>(z.bar.hat)<span class="op">/</span>beta</a>
<a class="sourceLine" id="cb34-2" data-line-number="2"><span class="kw">plot</span>(x, y.bar, <span class="dt">ylab =</span> <span class="st">&quot;log(inc) - mean(log(inc))&quot;</span>)</a>
<a class="sourceLine" id="cb34-3" data-line-number="3"><span class="kw">lines</span>(x, y.bar.hat)</a>
<a class="sourceLine" id="cb34-4" data-line-number="4"><span class="kw">title</span>(<span class="st">&quot;Mean standardized log-income&quot;</span>)</a>
<a class="sourceLine" id="cb34-5" data-line-number="5"><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&quot;observed&quot;</span>, <span class="st">&quot;fitted&quot;</span>),</a>
<a class="sourceLine" id="cb34-6" data-line-number="6">       <span class="dt">pch =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">-1</span>), <span class="dt">lty =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))</a></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="co">##</span></a>
<a class="sourceLine" id="cb35-2" data-line-number="2">( <span class="dt">bar.log.y =</span> <span class="kw">mean</span>(<span class="kw">log</span>(my.dt<span class="op">$</span>y_orig)) )</a></code></pre></div>
<pre><code>## [1] 7.03562</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1">y_orig.bar.hat.wrong &lt;-<span class="st"> </span><span class="kw">exp</span>(y.bar.hat) <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>( bar.log.y) <span class="co">## this is geometric mean</span></a>
<a class="sourceLine" id="cb37-2" data-line-number="2">y_orig.bar.hat.right &lt;-<span class="st"> </span><span class="kw">exp</span>(y.bar.hat)<span class="op">*</span>y_orig.bar[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb37-3" data-line-number="3"><span class="kw">plot</span>(x, y_orig.bar, <span class="dt">ylab =</span> <span class="st">&quot;$ per year&quot;</span>)</a>
<a class="sourceLine" id="cb37-4" data-line-number="4"><span class="kw">title</span>(<span class="st">&quot;Mean income&quot;</span>)</a>
<a class="sourceLine" id="cb37-5" data-line-number="5"><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&quot;observed&quot;</span>, <span class="st">&quot;fitted&quot;</span>),</a>
<a class="sourceLine" id="cb37-6" data-line-number="6">       <span class="dt">pch =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">-1</span>), <span class="dt">lty =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb37-7" data-line-number="7"><span class="kw">lines</span>(x, y_orig.bar.hat.wrong, <span class="dt">lty =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb37-8" data-line-number="8"><span class="kw">lines</span>(x, y_orig.bar.hat.right, <span class="dt">lty =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-16-2.png" width="672" /></p>
</div>
<div id="discuss-our-conclusions-and-possible-future-directions-to-follow." class="section level3">
<h3><span class="header-section-number">4.2.8</span> Discuss our conclusions and possible future directions to follow.</h3>
<blockquote>
<p>How did we do? Does our gamma frailty model give basically the right prediction?</p>
</blockquote>
<blockquote>
<p>How come it appears that wage income matters so little?</p>
</blockquote>
<blockquote>
<p>How could we improve the measurement of wage income?</p>
</blockquote>
<blockquote>
<p>What other variables could we look at?</p>
</blockquote>
<blockquote>
<p>How would we expect the gamma model do with another variable, e.g. educational attainment?</p>
</blockquote>
<blockquote>
<p>What is the relationship between “observed” and “unobserved” frailty?</p>
</blockquote>
<blockquote>
<p>IMPORTANT: Is our work here a validation of the model’s applicability to real life? If so what are we validating? That our transformed covariate is roughly gamma distributed? Are we assuming multiplicative fixed frailty – or are we validating it’s applicability?</p>
</blockquote>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="frailty.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="convergence-and-cross-overs.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/03-gamma_censoc_application.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
